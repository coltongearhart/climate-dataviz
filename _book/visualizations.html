<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.376">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Climate Change Data Visualization - 1&nbsp; Visualizations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./report.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./visualizations.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Visualizations</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title"><span id="sec-visualizations" class="quarto-section-identifier"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Visualizations</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Climate Change Data Visualization</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualizations.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Visualizations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./report.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Report</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#read-in-data" id="toc-read-in-data" class="nav-link active" data-scroll-target="#read-in-data"><span class="header-section-number">1.1</span> Read in data</a></li>
  <li>
<a href="#base-data-manipulation" id="toc-base-data-manipulation" class="nav-link" data-scroll-target="#base-data-manipulation"><span class="header-section-number">1.2</span> Base data manipulation</a>
  <ul class="collapse">
<li><a href="#basic-data-cleaning" id="toc-basic-data-cleaning" class="nav-link" data-scroll-target="#basic-data-cleaning"><span class="header-section-number">1.2.1</span> Basic data cleaning</a></li>
  <li><a href="#missing-data" id="toc-missing-data" class="nav-link" data-scroll-target="#missing-data"><span class="header-section-number">1.2.2</span> Missing data</a></li>
  <li><a href="#extra-observations" id="toc-extra-observations" class="nav-link" data-scroll-target="#extra-observations"><span class="header-section-number">1.2.3</span> Extra observations</a></li>
  <li><a href="#final-modifications" id="toc-final-modifications" class="nav-link" data-scroll-target="#final-modifications"><span class="header-section-number">1.2.4</span> Final modifications</a></li>
  </ul>
</li>
  <li>
<a href="#create-visualization-data" id="toc-create-visualization-data" class="nav-link" data-scroll-target="#create-visualization-data"><span class="header-section-number">1.3</span> Create visualization data</a>
  <ul class="collapse">
<li><a href="#monthly-averages" id="toc-monthly-averages" class="nav-link" data-scroll-target="#monthly-averages"><span class="header-section-number">1.3.1</span> Monthly averages</a></li>
  <li><a href="#projections" id="toc-projections" class="nav-link" data-scroll-target="#projections"><span class="header-section-number">1.3.2</span> Projections</a></li>
  <li><a href="#window-setting" id="toc-window-setting" class="nav-link" data-scroll-target="#window-setting"><span class="header-section-number">1.3.3</span> Window setting</a></li>
  </ul>
</li>
  <li>
<a href="#visualizations" id="toc-visualizations" class="nav-link" data-scroll-target="#visualizations"><span class="header-section-number">1.4</span> Visualizations</a>
  <ul class="collapse">
<li><a href="#strategy-and-descriptions" id="toc-strategy-and-descriptions" class="nav-link" data-scroll-target="#strategy-and-descriptions"><span class="header-section-number">1.4.1</span> Strategy and descriptions</a></li>
  <li><a href="#function-for-implementation" id="toc-function-for-implementation" class="nav-link" data-scroll-target="#function-for-implementation"><span class="header-section-number">1.4.2</span> Function for implementation</a></li>
  <li><a href="#minumum-temperatures" id="toc-minumum-temperatures" class="nav-link" data-scroll-target="#minumum-temperatures"><span class="header-section-number">1.4.3</span> Minumum temperatures</a></li>
  <li><a href="#maximum-temperatures" id="toc-maximum-temperatures" class="nav-link" data-scroll-target="#maximum-temperatures"><span class="header-section-number">1.4.4</span> Maximum temperatures</a></li>
  <li><a href="#precipitation-levels" id="toc-precipitation-levels" class="nav-link" data-scroll-target="#precipitation-levels"><span class="header-section-number">1.4.5</span> Precipitation levels</a></li>
  </ul>
</li>
  <li><a href="#save-plots" id="toc-save-plots" class="nav-link" data-scroll-target="#save-plots"><span class="header-section-number">1.5</span> Save plots</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><section id="read-in-data" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="read-in-data">
<span class="header-section-number">1.1</span> Read in data</h2>
<p>Data is from the Daily Global Historical Climatology Network (GHCN). It only includes three selected stations (one in AK, AU and HI) and ranges from years 1950 to 2019. The units for elements of interest (TMIN &amp; TMAX: tenths of degrees celsius; PRCP: tenths of mm; SNOW &amp; SNWD: mm).</p>
<div class="cell" data-hash="visualizations_cache/html/read-data_4d71b198038d918434cd7ad7a80a2736">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># read in data</span></span>
<span><span class="op">(</span><span class="va">data_climate_raw</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"Files/Data/climate-data.csv"</span>,</span>
<span>                         col_names <span class="op">=</span> <span class="cn">TRUE</span>, col_types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ccDcnccc"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 268,454 × 8
   StationID   Location Date       Element Value MFlag QFlag SFlag
   &lt;chr&gt;       &lt;chr&gt;    &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1 USC00511125 HI       1950-12-01 TMAX      239 &lt;NA&gt;  &lt;NA&gt;  0    
 2 USC00511125 HI       1950-12-01 TMIN      200 &lt;NA&gt;  &lt;NA&gt;  0    
 3 USC00511125 HI       1950-12-01 PRCP       79 &lt;NA&gt;  &lt;NA&gt;  0    
 4 USC00511125 HI       1950-12-01 SNOW        0 &lt;NA&gt;  &lt;NA&gt;  0    
 5 USC00511125 HI       1950-12-01 SNWD        0 &lt;NA&gt;  &lt;NA&gt;  0    
 6 USC00511125 HI       1950-12-02 TMAX      233 &lt;NA&gt;  &lt;NA&gt;  0    
 7 USC00511125 HI       1950-12-02 TMIN      189 &lt;NA&gt;  &lt;NA&gt;  0    
 8 USC00511125 HI       1950-12-02 PRCP      269 &lt;NA&gt;  &lt;NA&gt;  0    
 9 USC00511125 HI       1950-12-02 SNOW        0 &lt;NA&gt;  &lt;NA&gt;  0    
10 USC00511125 HI       1950-12-02 SNWD        0 &lt;NA&gt;  &lt;NA&gt;  0    
# ℹ 268,444 more rows</code></pre>
</div>
</div>
</section><section id="base-data-manipulation" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="base-data-manipulation">
<span class="header-section-number">1.2</span> Base data manipulation</h2>
<section id="basic-data-cleaning" class="level3" data-number="1.2.1"><h3 data-number="1.2.1" class="anchored" data-anchor-id="basic-data-cleaning">
<span class="header-section-number">1.2.1</span> Basic data cleaning</h3>
<p>Now lets do some basic cleaning of the data, including removing unnecessary columns and filtering to only the initial elements of interest.</p>
<div class="cell" data-hash="visualizations_cache/html/clean-data_ae3a3126780e9aab0060c96feebb25b2">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># clean up data</span></span>
<span><span class="co"># -&gt; remove unnecessary columns</span></span>
<span><span class="co"># -&gt; filter to only desired elements</span></span>
<span><span class="op">(</span><span class="va">data_clean</span> <span class="op">&lt;-</span> <span class="va">data_climate_raw</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu">ends_with</span><span class="op">(</span><span class="st">"Flag"</span><span class="op">)</span>,</span>
<span>         <span class="op">-</span><span class="va">StationID</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Element</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TMIN"</span>, <span class="st">"TMAX"</span>, <span class="st">"PRCP"</span>, <span class="st">"SNOW"</span>, <span class="st">"SNWD"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 236,232 × 4
   Location Date       Element Value
   &lt;chr&gt;    &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;
 1 HI       1950-12-01 TMAX      239
 2 HI       1950-12-01 TMIN      200
 3 HI       1950-12-01 PRCP       79
 4 HI       1950-12-01 SNOW        0
 5 HI       1950-12-01 SNWD        0
 6 HI       1950-12-02 TMAX      233
 7 HI       1950-12-02 TMIN      189
 8 HI       1950-12-02 PRCP      269
 9 HI       1950-12-02 SNOW        0
10 HI       1950-12-02 SNWD        0
# ℹ 236,222 more rows</code></pre>
</div>
</div>
</section><section id="missing-data" class="level3" data-number="1.2.2"><h3 data-number="1.2.2" class="anchored" data-anchor-id="missing-data">
<span class="header-section-number">1.2.2</span> Missing data</h3>
<p>Next step is to check to see if there is any missing data. To do this, we can count the number of observations for each year in each respective group. We expect there to be one observation per day, so ideally approximately 365 observations per year at each location for each measurement.</p>
<div class="cell" data-hash="visualizations_cache/html/check-missing_cbe991b88cc7913a2e891da177c9abc5">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># check dataset for years with missing data</span></span>
<span><span class="co"># -&gt; count the number of days within each year that have a measurement (for all elements from each location)</span></span>
<span><span class="op">(</span><span class="va">data_years</span> <span class="op">&lt;-</span> <span class="va">data_clean</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">Location</span>,</span>
<span>        year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span>,</span>
<span>        <span class="va">Element</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 711 × 4
   Location  year Element     n
   &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt;
 1 AK        1963 PRCP       55
 2 AK        1963 SNOW       55
 3 AK        1963 SNWD       55
 4 AK        1963 TMAX       55
 5 AK        1963 TMIN       55
 6 AK        1964 PRCP       89
 7 AK        1964 SNOW       89
 8 AK        1964 SNWD       14
 9 AK        1964 TMAX       87
10 AK        1964 TMIN       87
# ℹ 701 more rows</code></pre>
</div>
</div>
<p>In order to find things to look into more, lets create a visual for a quick inspection of the count data.</p>
<div class="cell" data-hash="visualizations_cache/html/fig-days-in-year_c8fdcc8aaf781fbfab22e8c041fcdde8">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create plot to visualize the wide data, which represents the total number of days with observations for each year</span></span>
<span><span class="co"># do this for each location and element combination</span></span>
<span><span class="co"># add a horizontal line at 365 days, which contextually represents data collected everyday of said year</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>,</span>
<span>                 y <span class="op">=</span> <span class="va">n</span><span class="op">)</span>,</span>
<span>             data <span class="op">=</span> <span class="va">data_years</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">365</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">Location</span> <span class="op">~</span> <span class="va">Element</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-days-in-year" class="quarto-figure quarto-figure-center anchored" width="672" data-fig-pos="hold">
<figure class="quarto-float quarto-float-fig figure"><div>
<img src="visualizations_files/figure-html/fig-days-in-year-1.png" id="fig-days-in-year" class="img-fluid figure-img" data-fig-pos="hold" width="672">
</div>
</figure>
</div>
</div>
</div>
<p>Here are some observations:</p>
<ol type="1">
<li><p>No snow data for AU.</p></li>
<li><p>A few years with more 365 obs.</p></li>
<li><p>Only consistent full years of data for AK after around 1980.</p></li>
<li><p>Not consistent full year of data for HI beyond 2002.</p></li>
</ol>
<p>Thoughts on these:</p>
<ol type="1">
<li><p>Should can not work with SNOW and SNWD moving forward. This is because the final goal is to be able to visualize elements that have data for all three locations.</p></li>
<li><p>Not sure what this means, so we might want to consider removing these data points? Unclear at this time.</p></li>
<li><p>Should only use data for years 1980 and beyond for AK moving forward.</p></li>
<li><p>Should only use data up to and including year 2002 for HI moving forward.</p></li>
</ol>
<p>Now that we have visually inspected the count data, we can make some initial decisions about which data to work or not work with. Getting these out of the way before diving in more will make it easier.</p>
<div class="cell" data-hash="visualizations_cache/html/keep-elements_9bce59955dbbc3aa08d1512347ddde7a">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># start refining the data</span></span>
<span><span class="co"># -&gt; keep only the elements that are going to be visualized</span></span>
<span><span class="op">(</span><span class="va">data_climate</span> <span class="op">&lt;-</span> <span class="va">data_clean</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Element</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TMIN"</span>,</span>
<span>                        <span class="st">"TMAX"</span>,</span>
<span>                        <span class="st">"PRCP"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 163,669 × 4
   Location Date       Element Value
   &lt;chr&gt;    &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;
 1 HI       1950-12-01 TMAX      239
 2 HI       1950-12-01 TMIN      200
 3 HI       1950-12-01 PRCP       79
 4 HI       1950-12-02 TMAX      233
 5 HI       1950-12-02 TMIN      189
 6 HI       1950-12-02 PRCP      269
 7 HI       1950-12-03 TMAX      228
 8 HI       1950-12-03 TMIN      194
 9 HI       1950-12-03 PRCP      457
10 HI       1950-12-04 TMAX      267
# ℹ 163,659 more rows</code></pre>
</div>
</div>
<p>Now lets look into the count data with only the desired elements to see exactly what’s going on.</p>
<div class="cell" data-hash="visualizations_cache/html/inspect-elements_ebf8721c2ba5c0026ebe25ea476929fb">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># look further into count data</span></span>
<span><span class="co"># convert to wide data to be able to compactly look at how much data there is (or is not) for each element</span></span>
<span><span class="co"># can also manually sort by year to look at locations within year when inspecting</span></span>
<span><span class="op">(</span><span class="va">data_years_wide</span> <span class="op">&lt;-</span> <span class="va">data_climate</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">Location</span>,</span>
<span>        year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span>,</span>
<span>        <span class="va">Element</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"Element"</span>,</span>
<span>              values_from <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 163 × 5
   Location  year  PRCP  TMAX  TMIN
   &lt;chr&gt;    &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1 AK        1963    55    55    55
 2 AK        1964    89    87    87
 3 AK        1965   120   120   120
 4 AK        1966   119   120   120
 5 AK        1967   165   202   202
 6 AK        1968   211   326   326
 7 AK        1969    55    61    61
 8 AK        1970   349   356   356
 9 AK        1971   363   327   328
10 AK        1972   354   297   297
# ℹ 153 more rows</code></pre>
</div>
</div>
<p>After closely looking through this representation of the count data, we can confirm the several of the observations made from the first visual. Low number of observations lead us to focus on data within locations that do not include the following years of data:</p>
<ul>
<li><p>Sets of years where there is consistently not good data.</p></li>
<li><p>One-off years with only a few observations.</p></li>
</ul>
<p>Also note that there is no data in the original dataset from 2003 for some reason. This will obviously show up in the final visuals, but nothing that can be done about it (although measures will be taken to ensure accurate portrayals as described later).</p>
<div class="cell" data-hash="visualizations_cache/html/remove-years_fc72325a3039b6573d8b8ac063aba547">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># continue refining climate data to move forward with</span></span>
<span><span class="co"># -&gt; remove years with not good data</span></span>
<span><span class="op">(</span><span class="va">data_climate</span> <span class="op">%&lt;&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">Location</span> <span class="op">==</span> <span class="st">"AK"</span> <span class="op">&amp;</span> <span class="op">(</span><span class="fu">year</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1980</span> <span class="op">|</span> <span class="fu">year</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2019</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         <span class="op">!</span><span class="op">(</span><span class="va">Location</span> <span class="op">==</span> <span class="st">"AU"</span> <span class="op">&amp;</span> <span class="op">(</span><span class="fu">year</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1970</span>, <span class="fl">2019</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         <span class="op">!</span><span class="op">(</span><span class="va">Location</span> <span class="op">==</span> <span class="st">"HI"</span> <span class="op">&amp;</span> <span class="op">(</span><span class="fu">year</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">2002</span> <span class="op">|</span> <span class="fu">year</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1950</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-error">
<pre><code>Error in data_climate %&lt;&gt;% filter(!(Location == "AK" &amp; (year(Date) &lt; 1980 | : could not find function "%&lt;&gt;%"</code></pre>
</div>
</div>
</section><section id="extra-observations" class="level3" data-number="1.2.3"><h3 data-number="1.2.3" class="anchored" data-anchor-id="extra-observations">
<span class="header-section-number">1.2.3</span> Extra observations</h3>
<p>Now lets look into data from 2004. As of now, we are not sure why there are multiple observations for each date across all elements.</p>
<div class="cell" data-hash="visualizations_cache/html/check_data_2004_2f8c5feb1d84d92597e80fdeab34f711">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># confirm this by counting the number of observations per day for each element / location combo</span></span>
<span><span class="co"># -&gt; filter to only 2004 data</span></span>
<span><span class="co"># -&gt; split into dataframe subsets for each element</span></span>
<span><span class="co"># -&gt; do the counting on each subset</span></span>
<span><span class="co"># -&gt; combine results into an organized dataframe</span></span>
<span><span class="op">(</span><span class="va">data_2004_check</span> <span class="op">&lt;-</span> <span class="va">data_climate</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">year</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2004</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">Element</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mclapply</span><span class="op">(</span>FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">element_data</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># count the number of rows per day</span></span>
<span>    <span class="co"># add back in the element info for when combining the results later</span></span>
<span>    <span class="va">element_data</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">count</span><span class="op">(</span><span class="va">Location</span>, <span class="va">Date</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">mutate</span><span class="op">(</span>Element <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">element_data</span><span class="op">$</span><span class="va">Element</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="op">}</span>, mc.cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span>f <span class="op">=</span> <span class="va">bind_rows</span>, x <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,025 × 4
   Location Date           n Element
   &lt;chr&gt;    &lt;date&gt;     &lt;int&gt; &lt;chr&gt;  
 1 AK       2004-01-01     2 PRCP   
 2 AK       2004-01-02     2 PRCP   
 3 AK       2004-01-03     2 PRCP   
 4 AK       2004-01-04     2 PRCP   
 5 AK       2004-01-05     2 PRCP   
 6 AK       2004-01-06     2 PRCP   
 7 AK       2004-01-07     2 PRCP   
 8 AK       2004-01-08     2 PRCP   
 9 AK       2004-01-09     2 PRCP   
10 AK       2004-01-10     2 PRCP   
# ℹ 3,015 more rows</code></pre>
</div>
</div>
<p>We see <span class="math inline">\(n = 2\)</span>, so multiple observations for each day is confirmed. To consolidate these, we are going to average all observations from a single day. This is to have just a single value per day, which will ensure that each day has the same weight when taking monthly averages later. If one day has more than one record, then it would be like there is an extra day, which is an inaccurate interpretation.</p>
<div class="cell" data-hash="visualizations_cache/html/adjust_data_2004_fcea69305b9157771d29b9a0ce679b84">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># adjust data from 2004</span></span>
<span><span class="co"># -&gt; filter climate data to only 2004</span></span>
<span><span class="co"># -&gt; group by identifying variables</span></span>
<span><span class="co"># -&gt; average the multiple observations</span></span>
<span><span class="op">(</span><span class="va">data_2004</span> <span class="op">&lt;-</span> <span class="va">data_climate</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">year</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2004</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Element</span>, <span class="va">Location</span>, <span class="va">Date</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>Value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="va">ungroup</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,025 × 4
   Element Location Date       Value
   &lt;chr&gt;   &lt;chr&gt;    &lt;date&gt;     &lt;dbl&gt;
 1 PRCP    AK       2004-01-01     0
 2 PRCP    AK       2004-01-02     0
 3 PRCP    AK       2004-01-03     0
 4 PRCP    AK       2004-01-04     0
 5 PRCP    AK       2004-01-05     0
 6 PRCP    AK       2004-01-06     0
 7 PRCP    AK       2004-01-07     0
 8 PRCP    AK       2004-01-08     0
 9 PRCP    AK       2004-01-09   185
10 PRCP    AK       2004-01-10   231
# ℹ 3,015 more rows</code></pre>
</div>
</div>
<p>Now lets count the adjusted data to confirm that is has been correctly addressed.</p>
<div class="cell" data-hash="visualizations_cache/html/recheck_data_2004_19e7862bd3dd4d13dc93de98381ea657">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># now run the summarized data back through the checking procedure to confirm that there is now only one obs per day</span></span>
<span><span class="op">(</span><span class="va">data_2004_recheck</span> <span class="op">&lt;-</span> <span class="va">data_2004</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">Element</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mclapply</span><span class="op">(</span>FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">element_data</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">element_data</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">count</span><span class="op">(</span><span class="va">Location</span>, <span class="va">Date</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">mutate</span><span class="op">(</span>Element <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">element_data</span><span class="op">$</span><span class="va">Element</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span>, mc.cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span>f <span class="op">=</span> <span class="va">bind_rows</span>, x <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,025 × 4
   Location Date           n Element
   &lt;chr&gt;    &lt;date&gt;     &lt;int&gt; &lt;chr&gt;  
 1 AK       2004-01-01     1 PRCP   
 2 AK       2004-01-02     1 PRCP   
 3 AK       2004-01-03     1 PRCP   
 4 AK       2004-01-04     1 PRCP   
 5 AK       2004-01-05     1 PRCP   
 6 AK       2004-01-06     1 PRCP   
 7 AK       2004-01-07     1 PRCP   
 8 AK       2004-01-08     1 PRCP   
 9 AK       2004-01-09     1 PRCP   
10 AK       2004-01-10     1 PRCP   
# ℹ 3,015 more rows</code></pre>
</div>
</div>
</section><section id="final-modifications" class="level3" data-number="1.2.4"><h3 data-number="1.2.4" class="anchored" data-anchor-id="final-modifications">
<span class="header-section-number">1.2.4</span> Final modifications</h3>
<p>Now can make the final refinements to the climate dataset.</p>
<div class="cell" data-hash="visualizations_cache/html/more-data-manipulations_22df0c82f3173f925799110f47dc0310">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># now continue with refining climate dataset</span></span>
<span><span class="co"># -&gt; remove original 2004 data</span></span>
<span><span class="co"># -&gt; add in the corrected 2004 data to the rest of the correct data</span></span>
<span><span class="co"># -&gt; sort in a logical way</span></span>
<span><span class="co"># -&gt; adjust values to have readable units (originally in 10ths of degrees and 10ths of mm)</span></span>
<span><span class="co"># -&gt; remove original value variable</span></span>
<span><span class="co"># this is a final plotting dataset as well as the base dataset that future datasets start with </span></span>
<span><span class="op">(</span><span class="va">data_climate</span> <span class="op">%&lt;&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">year</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">2004</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">bind_rows</span><span class="op">(</span><span class="va">data_2004</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">Element</span>, <span class="va">Location</span>, <span class="va">Date</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>value <span class="op">=</span> <span class="va">Value</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 160,644 × 4
   Location Date       Element value
   &lt;chr&gt;    &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;
 1 AK       1963-11-07 PRCP      0  
 2 AK       1963-11-08 PRCP      0  
 3 AK       1963-11-09 PRCP     10.4
 4 AK       1963-11-10 PRCP      5.6
 5 AK       1963-11-11 PRCP      0  
 6 AK       1963-11-12 PRCP      0  
 7 AK       1963-11-13 PRCP      0  
 8 AK       1963-11-14 PRCP      0  
 9 AK       1963-11-15 PRCP      0  
10 AK       1963-11-16 PRCP      0  
# ℹ 160,634 more rows</code></pre>
</div>
</div>
<p>As a final confirmation, lets recreate the first visual with the new refined dataset.</p>
<div class="cell" data-hash="visualizations_cache/html/check-final-data_b8dc8744b4d7041fa851a0a6e1435ee4">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># check years for final dataset by running the data through the counting and plotting process from above</span></span>
<span><span class="va">data_climate</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">Location</span>,</span>
<span>        year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span>,</span>
<span>        <span class="va">Element</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="op">{</span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>,</span>
<span>                     y <span class="op">=</span> <span class="va">n</span><span class="op">)</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">365</span>,</span>
<span>                 color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu">scale_y_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">400</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu">facet_grid</span><span class="op">(</span><span class="va">Location</span> <span class="op">~</span> <span class="va">Element</span><span class="op">)</span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-539a35d47e664c97a50115a146a7f1bd-1" class="quarto-figure quarto-figure-center anchored" width="672" data-fig-pos="hold">
<figure class="quarto-float quarto-float-fig figure"><div>
<img src="visualizations_files/figure-html/check-final-data-1.png" id="fig-539a35d47e664c97a50115a146a7f1bd-1" class="img-fluid figure-img" data-fig-pos="hold" width="672">
</div>
</figure>
</div>
</div>
</div>
<p>So now we have a dataset that contains data only from the elements of interest and the valid years for each respective location and correct units. It is now ready to be modified as needed for the desired visuals.</p>
</section></section><section id="create-visualization-data" class="level2" data-number="1.3"><h2 data-number="1.3" class="anchored" data-anchor-id="create-visualization-data">
<span class="header-section-number">1.3</span> Create visualization data</h2>
<p>With an idea of the final visuals in mine, we can start to construct the needed data for each feature of the plot.</p>
<section id="monthly-averages" class="level3" data-number="1.3.1"><h3 data-number="1.3.1" class="anchored" data-anchor-id="monthly-averages">
<span class="header-section-number">1.3.1</span> Monthly averages</h3>
<p>First is the monthly averages for each month within each location.</p>
<div class="cell" data-hash="visualizations_cache/html/data-monthly-average_1f65d555a32e405cf96b41989d3db2f3">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create dataset that contains average values for each month by location</span></span>
<span><span class="co"># this is a final plotting dataset</span></span>
<span><span class="co"># -&gt; extract the year and month of the date for grouping purposes </span></span>
<span><span class="co"># -&gt; set day to be the last day of each month and average the values for each month</span></span>
<span><span class="co"># -&gt; combine individual date related variables back into a full date variable and create a grouping variable (which is just for the line plot) that defines whether a time point is before or after the missing year (2003) of data </span></span>
<span><span class="co"># -&gt; select only the now wanted variables</span></span>
<span><span class="co"># --&gt; had to ungroup in prior step so that year and month aren't automatically included in the select statement by dplyr</span></span>
<span><span class="op">(</span><span class="va">data_monlthy_avg</span> <span class="op">&lt;-</span> <span class="va">data_climate</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span>,</span>
<span>         month <span class="op">=</span> <span class="fu">month</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Location</span>,</span>
<span>           <span class="va">year</span>,</span>
<span>           <span class="va">month</span>,</span>
<span>           <span class="va">Element</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu">day</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            value_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="va">ungroup</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">ymd</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         line_plot_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span>test <span class="op">=</span> <span class="va">year</span> <span class="op">&lt;</span> <span class="fl">2003</span>,</span>
<span>                                  yes <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  no <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">Location</span>,</span>
<span>         <span class="va">date</span>,</span>
<span>         <span class="va">Element</span>,</span>
<span>         <span class="va">value_avg</span>,</span>
<span>         <span class="va">line_plot_group</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,373 × 5
   Location date       Element value_avg line_plot_group
   &lt;chr&gt;    &lt;date&gt;     &lt;chr&gt;       &lt;dbl&gt;           &lt;dbl&gt;
 1 AK       1963-11-30 PRCP          1.7               1
 2 AK       1963-11-30 TMAX         -6.6               1
 3 AK       1963-11-30 TMIN        -13.2               1
 4 AK       1963-12-31 PRCP         10.3               1
 5 AK       1963-12-31 TMAX          2.2               1
 6 AK       1963-12-31 TMIN         -3.2               1
 7 AK       1964-01-31 PRCP          2.6               1
 8 AK       1964-01-31 TMAX         -1.4               1
 9 AK       1964-01-31 TMIN         -8.1               1
10 AK       1964-02-29 PRCP          7.4               1
# ℹ 5,363 more rows</code></pre>
</div>
</div>
</section><section id="projections" class="level3" data-number="1.3.2"><h3 data-number="1.3.2" class="anchored" data-anchor-id="projections">
<span class="header-section-number">1.3.2</span> Projections</h3>
<p>Now we are going to create the dataset to model the different types of projections that will be included in the final plot. This requires several intermediate datasets before they can be combined into a final projections dataset. Below is the first one, which will contain information about the intitial average values to be used for comparison purposes.</p>
<div class="cell" data-hash="visualizations_cache/html/data-projections_ceb8d2587465d25a172e4dc00b37bc16">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create a dataset that will be used to plot a horizontal line</span></span>
<span><span class="co"># this is an intermediate dataset for the final plotting data</span></span>
<span><span class="co"># the y value should equal the average value during first five years of data collection</span></span>
<span><span class="co"># and the x values will be the first and last dates of data collection so that the line spans the entire time frame</span></span>
<span><span class="co"># -&gt; group by element and location (so the next calculations are group-wise)</span></span>
<span><span class="co"># -&gt; calculate year, the minimum year (in order to get the limit year for the 5 year avg) and the exact first and last dates of data collection</span></span>
<span><span class="co"># -&gt; filter data to only observations in the first 5 years of data collection</span></span>
<span><span class="co"># -&gt; group by again, we need to group by first and last date as well in order to keep those columns (it doesn't affect the following summarizing calculations)</span></span>
<span><span class="co"># -&gt; calculate the average temps for each location</span></span>
<span><span class="op">(</span><span class="va">data_baseline</span> <span class="op">&lt;-</span> <span class="va">data_climate</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Element</span>, </span>
<span>           <span class="va">Location</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span>,</span>
<span>         year_first <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>         date_first <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span>,</span>
<span>         date_last <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&lt;</span> <span class="va">year_first</span> <span class="op">+</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Element</span>,</span>
<span>           <span class="va">Location</span>,</span>
<span>           <span class="va">date_first</span>,</span>
<span>           <span class="va">date_last</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>value_5avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="va">ungroup</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 5
  Element Location date_first date_last  value_5avg
  &lt;chr&gt;   &lt;chr&gt;    &lt;date&gt;     &lt;date&gt;          &lt;dbl&gt;
1 PRCP    AK       1963-11-07 2019-03-17        4.9
2 PRCP    AU       1970-07-01 2019-03-13        1.7
3 PRCP    HI       1950-12-01 2019-03-16        5  
4 TMAX    AK       1963-11-07 2019-03-17        2.8
5 TMAX    AU       1970-07-01 2019-02-27       19.3
6 TMAX    HI       1950-12-01 2019-03-17       26.8
7 TMIN    AK       1963-11-07 2019-03-17       -6.3
8 TMIN    AU       1970-07-01 2019-02-28        9.1
9 TMIN    HI       1950-12-01 2019-03-17       18.7</code></pre>
</div>
</div>
<p>Next is the second intermediate dataset, which will capture information based on a smooth curve fitted to the daily data.</p>
<div class="cell" data-hash="visualizations_cache/html/data-late-pred_1a9cd4c88b53346fcf3e1718db10bb09">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># goal is to get the predicted value from the last day of data collection based off some model</span></span>
<span><span class="co"># going to do loess regression with response as value (value) and predictor as number of days after (days_since) a round arbitrary start date (01/01/1950) that is before earliest data point </span></span>
<span><span class="co"># this is an intermediate dataset for the final plotting data</span></span>
<span><span class="co"># -&gt; calculate explanatory variable</span></span>
<span><span class="co"># -&gt; split dataset into a list with an element for each unique Location / Element combo</span></span>
<span><span class="co"># -&gt; run lapply for each element that does the following:</span></span>
<span><span class="co"># --&gt; fits a model and all extract predictions</span></span>
<span><span class="co"># --&gt; then create and return a dataframe that contains only the final predicted value and the location / element information</span></span>
<span><span class="co"># -&gt; finally combine each returned one-row dataframes into a single dataframe</span></span>
<span><span class="op">(</span><span class="va">data_last_pred</span> <span class="op">&lt;-</span> <span class="va">data_climate</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>days_since <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">Date</span> <span class="op">-</span> <span class="fu">ymd</span><span class="op">(</span><span class="st">"1950-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span>f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">Location</span>, </span>
<span>                  <span class="va">.</span><span class="op">$</span><span class="va">Element</span>,</span>
<span>                  sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mclapply</span><span class="op">(</span>FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">climate_data</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># fit loess model with specified response and predictor</span></span>
<span>    <span class="co"># -&gt; the model fit here matches what will be done with geom_smooth() in the final plot</span></span>
<span>    <span class="co"># -&gt; so using the same model parameters, which is span = 2 and is largerish more robust so that the smoothed line is not too fine / jaggedy (want it to be a smooth curve for visual purposes)</span></span>
<span>    <span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">value</span> <span class="op">~</span> <span class="va">days_since</span>,</span>
<span>                  span <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">climate_data</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># extract predicted values across all xs</span></span>
<span>    <span class="va">preds</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># create an organized one-row organized dataframe to return</span></span>
<span>    <span class="co"># -&gt; reduce modeling dataset to just one row that contains that needed id information</span></span>
<span>    <span class="co"># -&gt; extract just the last predicted value</span></span>
<span>    <span class="va">climate_data</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">distinct</span><span class="op">(</span><span class="va">Location</span>,</span>
<span>               <span class="va">Element</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">mutate</span><span class="op">(</span>last_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">preds</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="va">return</span></span>
<span></span>
<span>  <span class="op">}</span>, mc.cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span>f <span class="op">=</span> <span class="va">bind_rows</span>, x <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 3
  Location Element last_pred
  &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt;
1 AK       PRCP         5.1 
2 AK       TMAX         7.75
3 AK       TMIN        -0.15
4 AU       PRCP         1.41
5 AU       TMAX        21.3 
6 AU       TMIN        10.2 
7 HI       PRCP         6.61
8 HI       TMAX        25.6 
9 HI       TMIN        20.4 </code></pre>
</div>
</div>
<p>Now we can combine both the initial average info and the predictions from the model into the final projections dataset.</p>
<div class="cell" data-hash="visualizations_cache/html/data-projections-final_4115256cb5fe1d07bb391cf3645ad4d1">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create dataset that contains all of the information related to projections, both the simple baseline average and the fancy model</span></span>
<span><span class="co"># this is a final plotting dataset</span></span>
<span><span class="co"># -&gt; add info about the final predicted value to the baseline data</span></span>
<span><span class="co"># now need to create the information about the error bar, which will summarize the differences between the two different projection methods</span></span>
<span><span class="co"># -&gt; do the following calculations:</span></span>
<span><span class="co"># --&gt; difference between the two final predictions</span></span>
<span><span class="co"># --&gt; sign of difference (for the label)</span></span>
<span><span class="co"># --&gt; character string of formatted error label</span></span>
<span><span class="co"># --&gt; location of midpoint of errorbar, which will be the y value of the label position on the final plot</span></span>
<span><span class="op">(</span><span class="va">data_projections</span> <span class="op">&lt;-</span> <span class="va">data_baseline</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">data_last_pred</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Element"</span>, <span class="st">"Location"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="va">ungroup</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">last_pred</span> <span class="op">-</span> <span class="va">value_5avg</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>         error_sign <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">error</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"+"</span>, <span class="st">"-"</span><span class="op">)</span>,</span>
<span>         error_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">error_sign</span> <span class="op">==</span> <span class="st">"+"</span>, <span class="st">"+"</span>, <span class="st">""</span><span class="op">)</span>,</span>
<span>                       <span class="va">error</span>,</span>
<span>                       <span class="st">"˚"</span>,</span>
<span>                       sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>         error_midpoint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">last_pred</span> <span class="op">+</span> <span class="va">value_5avg</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 10
  Element Location date_first date_last  value_5avg last_pred error error_sign
  &lt;chr&gt;   &lt;chr&gt;    &lt;date&gt;     &lt;date&gt;          &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     
1 PRCP    AK       1963-11-07 2019-03-17        4.9      5.1   0.2  +         
2 PRCP    AU       1970-07-01 2019-03-13        1.7      1.41 -0.29 -         
3 PRCP    HI       1950-12-01 2019-03-16        5        6.61  1.61 +         
4 TMAX    AK       1963-11-07 2019-03-17        2.8      7.75  4.95 +         
5 TMAX    AU       1970-07-01 2019-02-27       19.3     21.3   2.02 +         
6 TMAX    HI       1950-12-01 2019-03-17       26.8     25.6  -1.19 -         
7 TMIN    AK       1963-11-07 2019-03-17       -6.3     -0.15  6.15 +         
8 TMIN    AU       1970-07-01 2019-02-28        9.1     10.2   1.05 +         
9 TMIN    HI       1950-12-01 2019-03-17       18.7     20.4   1.73 +         
# ℹ 2 more variables: error_label &lt;chr&gt;, error_midpoint &lt;dbl&gt;</code></pre>
</div>
</div>
</section><section id="window-setting" class="level3" data-number="1.3.3"><h3 data-number="1.3.3" class="anchored" data-anchor-id="window-setting">
<span class="header-section-number">1.3.3</span> Window setting</h3>
<p>Because the impact of the final visuals depends heavily on visual comparisons, much care is needed to be taken in terms of the <span class="math inline">\(y\)</span> scales on each plot. Here is the thought process:</p>
<ul>
<li><p>When facetting with “free_y” scales for each location, visual comparisons of the error bars may be misleading. For accurate visual comparisons of the errors, the total range for each <span class="math inline">\(y\)</span> scale needs to be the same (so the error bars are correctly proportional).</p></li>
<li><p>“free_y” scales with facets will correctly position the limits for each panel’s data, but some data could appear to be zoomed in if the range for <span class="math inline">\(y\)</span> scale is smaller.</p></li>
<li><p>So we are going to figure out the maximum range between the largest and smallest avg monthly value (for each location). And then use that same range (and approximately centered around each respective baseline) for the other two locations.</p></li>
<li><p>As a result of the same range effect, the variability in monthly avg values will be presented correctly as well. So this info will be represented as a pair of <span class="math inline">\((x,y)\)</span> coordinates at the desired edges of the values’ scales.</p></li>
</ul>
<p>Now lets create a dataset that can reflect the conclusion we arrived at.</p>
<div class="cell" data-hash="visualizations_cache/html/data-windows_92e9b3df534157cf8d97b830c3258d99">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create dataset with the information needed for y limits of each panel</span></span>
<span><span class="co"># this is a final plotting dataset </span></span>
<span><span class="co"># -&gt; start with the monthly average values dataset because that data defines the y scale </span></span>
<span><span class="co"># -&gt; group by element and location</span></span>
<span><span class="co"># -&gt; figure out the min, max and range (max - min) values for each</span></span>
<span><span class="co"># now find the max range for each element</span></span>
<span><span class="co"># summarizing over Location because we want to the overall max as the new common max</span></span>
<span><span class="co"># do this by splitting the dataframe by element and an lapply that does the following on each subset:</span></span>
<span><span class="co"># -&gt; figures out the max range</span></span>
<span><span class="co"># -&gt; adds this info to the original subset with a join</span></span>
<span><span class="co"># -&gt; then combine resulting dataframes back into one overall dataframe</span></span>
<span><span class="co"># now we are going to add in the information about the baseline average</span></span>
<span><span class="co"># -&gt; use a join, just want the first date and 5 year avg info from the baseline info</span></span>
<span><span class="co"># -&gt; select and reorder info so can figure out how to set limits</span></span>
<span><span class="co"># -&gt; add width info to baseline dataset</span></span>
<span><span class="co"># manually set bounds for each panels window (just looked at numbers and set window bounds strategically)</span></span>
<span><span class="co"># did this according to the following strategy (for each element):</span></span>
<span><span class="co"># -&gt; window for each panel (location) needs to be the same as the overall max range so that can compare error bars accurately</span></span>
<span><span class="co"># -&gt; and preferably centered around the 5 year average, just for aesthetic purposes</span></span>
<span><span class="co"># -&gt; add this via numeric constants in a mutate statement</span></span>
<span><span class="co"># -&gt; note that rain fall has a natural lower bound of zero, so curves wont really be centered in the windows</span></span>
<span><span class="co"># -&gt; and windows for rain are quite large (relative to values for AK and AU) because of the high variability in HI</span></span>
<span><span class="co"># now want to format data so that it can be handled by ggplot and the facets</span></span>
<span><span class="co"># -&gt; convert to to tall data, creating a column for the value of the bound and which window it corresponds to (lower / upper)</span></span>
<span><span class="co"># -&gt; keep only needed variables</span></span>
<span><span class="co"># --&gt; going to use the the first day of data collection as the x coordinate, it's just an arbitrary choice</span></span>
<span><span class="op">(</span><span class="va">data_y_limits</span> <span class="op">&lt;-</span> <span class="va">data_monlthy_avg</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Element</span>,</span>
<span>           <span class="va">Location</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="va">value_avg</span>,</span>
<span>                   .fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"min"</span> <span class="op">=</span> <span class="va">min</span>, <span class="st">"max"</span> <span class="op">=</span> <span class="va">max</span><span class="op">)</span>,</span>
<span>                   .names <span class="op">=</span> <span class="st">"{.fn}"</span><span class="op">)</span>,</span>
<span>            range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">value_avg</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span>f <span class="op">=</span> <span class="va">.</span><span class="op">$</span><span class="va">Element</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mclapply</span><span class="op">(</span>FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">avg_data</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># -&gt; calculate the maximum range across locations</span></span>
<span>    <span class="co"># -&gt; then add back in original info</span></span>
<span>    <span class="co"># -&gt; remove individual location range values</span></span>
<span>    <span class="va">avg_data</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">summarize</span><span class="op">(</span>max_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">range</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">right_join</span><span class="op">(</span><span class="va">avg_data</span>,</span>
<span>                 by <span class="op">=</span> <span class="st">"Element"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">range</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="va">return</span></span>
<span>    </span>
<span>  <span class="op">}</span>, mc.cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span>f <span class="op">=</span> <span class="va">bind_rows</span>,</span>
<span>         x <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>  </span>
<span>  <span class="fu">right_join</span><span class="op">(</span><span class="va">data_baseline</span>,</span>
<span>             by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Element"</span>,</span>
<span>                    <span class="st">"Location"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">Element</span>,</span>
<span>         <span class="va">Location</span>,</span>
<span>         <span class="va">date_first</span>,</span>
<span>         <span class="va">min</span>,</span>
<span>         <span class="va">max</span>,</span>
<span>         <span class="va">max_range</span>,</span>
<span>         <span class="va">value_5avg</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,</span>
<span>                   <span class="op">-</span><span class="fl">13</span>,<span class="fl">3.7</span>,<span class="fl">10.1</span>,</span>
<span>                   <span class="op">-</span><span class="fl">20</span>,<span class="op">-</span><span class="fl">5</span>,<span class="fl">2.8</span><span class="op">)</span>,</span>
<span>         upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">35</span>,<span class="fl">35</span>,<span class="fl">35</span>,</span>
<span>                   <span class="fl">20.8</span>,<span class="fl">37.5</span>,<span class="fl">43.9</span>,</span>
<span>                   <span class="fl">12</span>,<span class="fl">25.8</span>,<span class="fl">33.6</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lower</span>,</span>
<span>                        <span class="va">upper</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"y_window"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"bound"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">Element</span>,</span>
<span>         <span class="va">Location</span>,</span>
<span>         <span class="va">date_first</span>, </span>
<span>         <span class="va">y_window</span>,</span>
<span>         <span class="va">bound</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 5
   Element Location date_first y_window bound
   &lt;chr&gt;   &lt;chr&gt;    &lt;date&gt;     &lt;chr&gt;    &lt;dbl&gt;
 1 PRCP    AK       1963-11-07 lower      0  
 2 PRCP    AK       1963-11-07 upper     35  
 3 PRCP    AU       1970-07-01 lower      0  
 4 PRCP    AU       1970-07-01 upper     35  
 5 PRCP    HI       1950-12-01 lower      0  
 6 PRCP    HI       1950-12-01 upper     35  
 7 TMAX    AK       1963-11-07 lower    -13  
 8 TMAX    AK       1963-11-07 upper     20.8
 9 TMAX    AU       1970-07-01 lower      3.7
10 TMAX    AU       1970-07-01 upper     37.5
11 TMAX    HI       1950-12-01 lower     10.1
12 TMAX    HI       1950-12-01 upper     43.9
13 TMIN    AK       1963-11-07 lower    -20  
14 TMIN    AK       1963-11-07 upper     12  
15 TMIN    AU       1970-07-01 lower     -5  
16 TMIN    AU       1970-07-01 upper     25.8
17 TMIN    HI       1950-12-01 lower      2.8
18 TMIN    HI       1950-12-01 upper     33.6</code></pre>
</div>
</div>
</section></section><section id="visualizations" class="level2" data-number="1.4"><h2 data-number="1.4" class="anchored" data-anchor-id="visualizations">
<span class="header-section-number">1.4</span> Visualizations</h2>
<section id="strategy-and-descriptions" class="level3" data-number="1.4.1"><h3 data-number="1.4.1" class="anchored" data-anchor-id="strategy-and-descriptions">
<span class="header-section-number">1.4.1</span> Strategy and descriptions</h3>
<p>Here are descriptions of each feature of the final visuals and how they will be constructed.</p>
<p>Overall plot features / strategy:</p>
<ul>
<li><p>Never need to group by location because that gets facetted.</p></li>
<li><p>Filtering dataset for each geom for the correct element so that the code can remain the same between plots for the different responses.</p></li>
</ul>
<p>– Only have to set a constant for the element and main color at the start and then the ggplot is set up to incorporate that automatically.</p>
<p>– Using blue because of Storytelling With Data (SWD).</p>
<ul>
<li>Neutral colors will be various greys cause not as strong as black.</li>
</ul>
<p>Line plot of the average monthly values:</p>
<ul>
<li><p>Purpose is to show variability over time of avg values.</p></li>
<li><p>Not the focus, so make thinner and slightly transparent.</p></li>
<li><p>Adds the grouping variable so that the gap in the missing data shown with two separate lines rather than connecting across the gap.</p></li>
</ul>
<p>Smooth curve of daily temps:</p>
<ul>
<li><p>Plots loess model of daily values over time.</p></li>
<li><p>This model (including its parameters) is the same that was used to get the last predicted value in the projection data.</p></li>
<li><p>This is a main part of the plot, so thicker line.</p></li>
</ul>
<p>Baseline plot:</p>
<ul>
<li><p>Uses projection data.</p></li>
<li><p>Just a horizontal line at the first 5 year avg of daily values.</p></li>
<li><p>This is for comparison purposes, not a main focus so choosing a neutral color with a thinner line than the smooth curve (but thicker than the monthly avgs).</p></li>
</ul>
<p>Error bar:</p>
<ul>
<li><p>Uses projection data.</p></li>
<li><p>Sets <span class="math inline">\(x\)</span> last day of data collection, <span class="math inline">\(y\)</span> values are the last predicted value and baseline avg.</p></li>
<li><p>This is a standout feature of the plot, color will set manually based on what should be the focus.</p></li>
<li><p>Want to highlight the increases in temp (based on model compared to historical average) for narrative of the entire data viz.</p></li>
<li><p>And just changes in precipitation, not focusing on whether the change is an increase or decrease.</p></li>
</ul>
<p>Text labels for error bars:</p>
<ul>
<li><p>Uses projection data.</p></li>
<li><p>Set to the right of the error bars and centered at the midpoint.</p></li>
<li><p>Color coordinated with the error bars.</p></li>
</ul>
<p>Color scale for error bars and labels:</p>
<ul>
<li><p>For temps set a bright color for the errors that I want to highlight and a neutral color for the rest.</p></li>
<li><p>Using orange cause of SWD (blue / orange are good contrasting colors that don’t have an immediate connotation like red / green).</p></li>
<li><p>For precipitation, not highlighting whether a change was <span class="math inline">\(+/-\)</span>, so use two bright colors (rather than one bright and one neutral).</p></li>
</ul>
<p>Window (range) setting:</p>
<ul>
<li><p>This plot feature will be set up as an option within the function via a conditional statement.</p></li>
<li><p>Set up as an option so that it there is a concise way to add it in while also easily being able to have or not have it.</p></li>
<li><p>Had to manually look into what to set the window bounds as, so this feature is just for the final visualizations.</p></li>
<li><p>Uses plot values limits dataset.</p></li>
<li><p>Just adds data points set at the desired lower and upper bounds for each locations <span class="math inline">\(y\)</span> scale.</p></li>
<li><p>These data points are just to force the scales to include the correct range, so can make points invisible.</p></li>
</ul>
<p>Final aspects:</p>
<ul>
<li><p>Facet by location.</p></li>
<li><p>Modify theme slightly.</p></li>
</ul></section><section id="function-for-implementation" class="level3" data-number="1.4.2"><h3 data-number="1.4.2" class="anchored" data-anchor-id="function-for-implementation">
<span class="header-section-number">1.4.2</span> Function for implementation</h3>
<p>To implement these, lets define a function that will create a ggplot object with all of the above features that will be common across all plots. This is just for more concise code later; element specific features (such as labels and scale colors) will be added on individually later. And formal titles and captions will be added on last.</p>
<div class="cell" data-hash="visualizations_cache/html/function-common-plot_2f90ce785527d6a77e64c6c600afacbd">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># define a function that will return a ggplot object with all of the above features</span></span>
<span><span class="co"># -&gt; only need to specify character strings for the element of interest and the main color of the line plots</span></span>
<span><span class="co"># --&gt; default color value is black (which is neutralish) just so that can run code if don't want to specify one</span></span>
<span><span class="co"># this will contain only plot feature that are common across all elements</span></span>
<span><span class="co"># element specific features (such as labels and scale colors) will be tacked on afterwards, as well as the formal titles / captions</span></span>
<span><span class="co"># so when plotting a specific element, just have to call this function and then the rest of the layers that are modified to have info specific to the element of interest</span></span>
<span><span class="co"># note that this function depends on objects in the global environment</span></span>
<span><span class="co"># -&gt; so not necessarily the best way to code it</span></span>
<span><span class="co"># -&gt; but the datasets it requires have to be setup in a specific way according to the above data manipulations</span></span>
<span><span class="co"># -&gt; so this is just much easier and makes sense for how this application was carried out </span></span>
<span><span class="va">fun_common_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">element</span>,</span>
<span>                            <span class="va">color</span> <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>                            <span class="va">window_setting</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># create and save base plot object</span></span>
<span>  <span class="va">g</span> <span class="op">=</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>,</span>
<span>                  y <span class="op">=</span> <span class="va">value_avg</span>,</span>
<span>                  group <span class="op">=</span> <span class="va">line_plot_group</span><span class="op">)</span>,</span>
<span>              color <span class="op">=</span> <span class="va">color</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>              data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">data_monlthy_avg</span>,</span>
<span>                            <span class="va">Element</span> <span class="op">==</span> <span class="va">element</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">stat_smooth</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>,</span>
<span>                    y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span>
<span>                method <span class="op">=</span> <span class="st">"loess"</span>,</span>
<span>                span <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                color <span class="op">=</span> <span class="va">color</span>,</span>
<span>                data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">data_climate</span>,</span>
<span>                              <span class="va">Element</span> <span class="op">==</span> <span class="va">element</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_first</span>,</span>
<span>                     xend <span class="op">=</span> <span class="va">date_last</span>,</span>
<span>                     y <span class="op">=</span> <span class="va">value_5avg</span>,</span>
<span>                     yend <span class="op">=</span> <span class="va">value_5avg</span><span class="op">)</span>,</span>
<span>                 color <span class="op">=</span> <span class="st">"grey50"</span>,</span>
<span>                 data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">data_projections</span>,</span>
<span>                               <span class="va">Element</span> <span class="op">==</span> <span class="va">element</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_last</span>,</span>
<span>                      ymin <span class="op">=</span> <span class="va">value_5avg</span>,</span>
<span>                      ymax <span class="op">=</span> <span class="va">last_pred</span>,</span>
<span>                      color <span class="op">=</span> <span class="va">error_sign</span><span class="op">)</span>,</span>
<span>                  width <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                  linewidth <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                  show.legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">data_projections</span>, </span>
<span>                                <span class="va">Element</span> <span class="op">==</span> <span class="va">element</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_last</span>,</span>
<span>                  y <span class="op">=</span> <span class="va">error_midpoint</span>,</span>
<span>                  label <span class="op">=</span> <span class="va">error_label</span>,</span>
<span>                  color <span class="op">=</span> <span class="va">error_sign</span><span class="op">)</span>,</span>
<span>              nudge_x <span class="op">=</span> <span class="fl">1500</span>,</span>
<span>              size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>              show.legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">data_projections</span>,</span>
<span>                            <span class="va">Element</span> <span class="op">==</span> <span class="va">element</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">facet_grid</span><span class="op">(</span><span class="va">Location</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>               scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">theme</span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>          panel.border <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"lightgrey"</span>,</span>
<span>                                      fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># conditionally add range setting feature</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">window_setting</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">g</span> <span class="op">=</span> <span class="va">g</span> <span class="op">+</span> </span>
<span>      <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_first</span>,</span>
<span>                     y <span class="op">=</span> <span class="va">bound</span><span class="op">)</span>,</span>
<span>                 alpha <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                 data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">data_y_limits</span>,</span>
<span>                               <span class="va">Element</span> <span class="op">==</span> <span class="va">element</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># return plot object</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="minumum-temperatures" class="level3" data-number="1.4.3"><h3 data-number="1.4.3" class="anchored" data-anchor-id="minumum-temperatures">
<span class="header-section-number">1.4.3</span> Minumum temperatures</h3>
<p>Create base plot for minimum temperatures. This lets the facetting control the <span class="math inline">\(y\)</span> scales and does not activate the window setting feature.</p>
<div class="cell" data-hash="visualizations_cache/html/fig-tmin-common_52e91955fbf6a09c24e62819771723b3">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># visualize TMIN</span></span>
<span><span class="co"># -&gt; first visualize base plot </span></span>
<span><span class="fu">fun_common_plot</span><span class="op">(</span>element <span class="op">=</span> <span class="st">"TMIN"</span>,</span>
<span>                color <span class="op">=</span> <span class="st">"dodgerblue1"</span>,</span>
<span>                window_setting <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-tmin-common" class="quarto-figure quarto-figure-center anchored" width="672" data-fig-pos="hold">
<figure class="quarto-float quarto-float-fig figure"><div>
<img src="visualizations_files/figure-html/fig-tmin-common-1.png" id="fig-tmin-common" class="img-fluid figure-img" data-fig-pos="hold" width="672">
</div>
</figure>
</div>
</div>
</div>
<p>Now incorporate the specified windows into each panel.</p>
<div class="cell" data-hash="visualizations_cache/html/fig-tmin-window_283a237c10de21a3abaf9ab831fb93d3">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># -&gt; now add window setting feature</span></span>
<span><span class="fu">fun_common_plot</span><span class="op">(</span>element <span class="op">=</span> <span class="st">"TMIN"</span>,</span>
<span>                color <span class="op">=</span> <span class="st">"dodgerblue1"</span>,</span>
<span>                window_setting <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-error">
<pre><code>Error in fun_common_plot(element = "TMIN", color = "dodgerblue1", window_setting = TRUE): object 'data_y_limits' not found</code></pre>
</div>
</div>
<p>We see that this addition has the intended affect of setting equally wide and centered windows for each panels <span class="math inline">\(y\)</span> axis, which improves the image and allows for accurate visual comparisons of the error bars. So lets keep it! Now we can create the final visualization for minimum temperatures.</p>
<div class="cell" data-hash="visualizations_cache/html/fig-tmin-final_c287cc87241379933740f5088a0c2446">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># -&gt; then add the rest of the layers with formal info</span></span>
<span><span class="op">(</span><span class="va">plot_tmin</span> <span class="op">&lt;-</span> <span class="fu">fun_common_plot</span><span class="op">(</span>element <span class="op">=</span> <span class="st">"TMIN"</span>,</span>
<span>                             color <span class="op">=</span> <span class="st">"dodgerblue1"</span>,</span>
<span>                             window_setting <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"-"</span> <span class="op">=</span> <span class="st">"grey60"</span>, <span class="st">"+"</span> <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Average minimum temperatures over time \ncompared to average during first five years"</span>,</span>
<span>      subtitle <span class="op">=</span> <span class="st">"(with monthly averages overlaid)"</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Data source: Daily Global Historical Climatology Network (GHCN) \nPlot by Colton Gearhart"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Temperature (˚C)"</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-error">
<pre><code>Error in fun_common_plot(element = "TMIN", color = "dodgerblue1", window_setting = TRUE): object 'data_y_limits' not found</code></pre>
</div>
</div>
</section><section id="maximum-temperatures" class="level3" data-number="1.4.4"><h3 data-number="1.4.4" class="anchored" data-anchor-id="maximum-temperatures">
<span class="header-section-number">1.4.4</span> Maximum temperatures</h3>
<p>Now we can do the same process for maximumum temperatures.</p>
<div class="cell" data-hash="visualizations_cache/html/fig-tmax-common_fa442a8a8d9dde3923cdd5ae199bb4bb">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># visualize TMAX</span></span>
<span><span class="co"># -&gt; first create base plot </span></span>
<span><span class="fu">fun_common_plot</span><span class="op">(</span>element <span class="op">=</span> <span class="st">"TMAX"</span>,</span>
<span>                color <span class="op">=</span> <span class="st">"dodgerblue4"</span>, </span>
<span>                window_setting <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-tmax-common" class="quarto-figure quarto-figure-center anchored" width="672" data-fig-pos="hold">
<figure class="quarto-float quarto-float-fig figure"><div>
<img src="visualizations_files/figure-html/fig-tmax-common-1.png" id="fig-tmax-common" class="img-fluid figure-img" data-fig-pos="hold" width="672">
</div>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="visualizations_cache/html/fig-tmax-window_a7fbdca26e03556ef3ae9d8ee6ccd762">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># this improves image again, so keep it!</span></span>
<span><span class="co"># -&gt; now add window setting feature</span></span>
<span><span class="fu">fun_common_plot</span><span class="op">(</span>element <span class="op">=</span> <span class="st">"TMAX"</span>,</span>
<span>                color <span class="op">=</span> <span class="st">"dodgerblue4"</span>,</span>
<span>                window_setting <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-error">
<pre><code>Error in fun_common_plot(element = "TMAX", color = "dodgerblue4", window_setting = TRUE): object 'data_y_limits' not found</code></pre>
</div>
</div>
<div class="cell" data-hash="visualizations_cache/html/fig-tmax-final_8b4bdfdced26d25bb4d36538f8b30e78">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># -&gt; then add the rest of the layers with formal info</span></span>
<span><span class="co"># this is the final visualization for maximum temperatures</span></span>
<span><span class="op">(</span><span class="va">plot_tmax</span> <span class="op">&lt;-</span> <span class="fu">fun_common_plot</span><span class="op">(</span>element <span class="op">=</span> <span class="st">"TMAX"</span>,</span>
<span>                              color <span class="op">=</span> <span class="st">"dodgerblue4"</span>,</span>
<span>                              window_setting <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"-"</span> <span class="op">=</span> <span class="st">"grey60"</span>, <span class="st">"+"</span> <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Average maximum temperatures over time \ncompared to average during first five years"</span>,</span>
<span>      subtitle <span class="op">=</span> <span class="st">"(with monthly averages overlaid)"</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Data source: Daily Global Historical Climatology Network (GHCN) \nPlot by Colton Gearhart"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Temperature (˚C)"</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-error">
<pre><code>Error in fun_common_plot(element = "TMAX", color = "dodgerblue4", window_setting = TRUE): object 'data_y_limits' not found</code></pre>
</div>
</div>
</section><section id="precipitation-levels" class="level3" data-number="1.4.5"><h3 data-number="1.4.5" class="anchored" data-anchor-id="precipitation-levels">
<span class="header-section-number">1.4.5</span> Precipitation levels</h3>
<p>And again for precipitation levels.</p>
<div class="cell" data-hash="visualizations_cache/html/fig-prcp-common_f053e5937f3648bc787d9632db43cea0">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># visualize PRCP</span></span>
<span><span class="co">#  -&gt; first create base plot </span></span>
<span><span class="fu">fun_common_plot</span><span class="op">(</span>element <span class="op">=</span> <span class="st">"PRCP"</span>,</span>
<span>                color <span class="op">=</span> <span class="st">"turquoise"</span>,</span>
<span>                window_setting <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-prcp-common" class="quarto-figure quarto-figure-center anchored" width="672" data-fig-pos="hold">
<figure class="quarto-float quarto-float-fig figure"><div>
<img src="visualizations_files/figure-html/fig-prcp-common-1.png" id="fig-prcp-common" class="img-fluid figure-img" data-fig-pos="hold" width="672">
</div>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="visualizations_cache/html/fig-prcp-window_c3fa989c4b5aee82c4aece522b4c82ab">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># -&gt; now add window setting feature</span></span>
<span><span class="fu">fun_common_plot</span><span class="op">(</span>element <span class="op">=</span> <span class="st">"PRCP"</span>,</span>
<span>                color <span class="op">=</span> <span class="st">"turquoise"</span>,</span>
<span>                window_setting <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-error">
<pre><code>Error in fun_common_plot(element = "PRCP", color = "turquoise", window_setting = TRUE): object 'data_y_limits' not found</code></pre>
</div>
</div>
<div class="cell" data-hash="visualizations_cache/html/fig-prcp-final_99dd2bc462af514c9ac12a7d6fefe439">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># -&gt; then add the rest of the layers with formal info</span></span>
<span><span class="op">(</span><span class="va">plot_prcp</span> <span class="op">&lt;-</span> <span class="fu">fun_common_plot</span><span class="op">(</span>element <span class="op">=</span> <span class="st">"PRCP"</span>,</span>
<span>                             color <span class="op">=</span> <span class="st">"turquoise"</span>,</span>
<span>                             window_setting <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"-"</span> <span class="op">=</span> <span class="st">"gold2"</span>, <span class="st">"+"</span> <span class="op">=</span> <span class="st">"plum2"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Average precipitation levels over time \ncompared to average during first five years"</span>,</span>
<span>      subtitle <span class="op">=</span> <span class="st">"(with monthly averages overlaid)"</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Data source: Daily Global Historical Climatology Network (GHCN) \nPlot by Colton Gearhart"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Precipitation (mm)"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-error">
<pre><code>Error in fun_common_plot(element = "PRCP", color = "turquoise", window_setting = TRUE): object 'data_y_limits' not found</code></pre>
</div>
</div>
<p>Note that there is a natural lower bound of zero for precipitation levels and there is high variability in HI. So by forcing each panel to have the same range via the window setting, effects (i.e.&nbsp;error bars) are barely visible, but there is nothing that can really be done about this given the current implementation strategy. But perhaps the lack of effect (or minimal effect) tells something as well? This would likely be a question for a content expert.</p>
</section></section><section id="save-plots" class="level2" data-number="1.5"><h2 data-number="1.5" class="anchored" data-anchor-id="save-plots">
<span class="header-section-number">1.5</span> Save plots</h2>
<p>Below is code that can be used to save ggplots.</p>
<div class="cell" data-hash="visualizations_cache/html/save-plots_f39749c8b673c5c7b1867cf48946e660">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># save plots</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"Files/Images/Visual-TMIN.png"</span>,</span>
<span>       plot <span class="op">=</span> <span class="va">plot_tmin</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'plot_tmin' not found</code></pre>
</div>
<details open=""><summary>Code</summary><div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggsave</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"Files/Images/Visual-TMAX.png"</span>,</span>
<span>       plot <span class="op">=</span> <span class="va">plot_tmax</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'plot_tmax' not found</code></pre>
</div>
<details open=""><summary>Code</summary><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggsave</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"Files/Images/Visual-PRCP.png"</span>,</span>
<span>       plot <span class="op">=</span> <span class="va">plot_prcp</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'plot_prcp' not found</code></pre>
</div>
</div>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preface</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./report.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Report</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb55" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Visualizations {#sec-visualizations}</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-prereqs</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages, knitr options and plot theme</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"_common.R"</span>)</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## Read in data</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>Data is from the Daily Global Historical Climatology Network (GHCN). It only includes three selected stations (one in AK, AU and HI) and ranges from years 1950 to 2019. The units for elements of interest (TMIN &amp; TMAX: tenths of degrees celsius; PRCP: tenths of mm; SNOW &amp; SNWD: mm).</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: read-data</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a><span class="co"># read in data</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>(data_climate_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Files/Data/climate-data.csv"</span>,</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>                         <span class="at">col_names =</span> <span class="cn">TRUE</span>, <span class="at">col_types =</span> <span class="fu">c</span>(<span class="st">"ccDcnccc"</span>)))</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## Base data manipulation</span></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic data cleaning</span></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>Now lets do some basic cleaning of the data, including removing unnecessary columns and filtering to only the initial elements of interest.</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: clean-data</span></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a><span class="co"># clean up data</span></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; remove unnecessary columns</span></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; filter to only desired elements</span></span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>(data_clean <span class="ot">&lt;-</span> data_climate_raw <span class="sc">%&gt;%</span> </span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">"Flag"</span>),</span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>StationID) <span class="sc">%&gt;%</span> </span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Element <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"TMIN"</span>, <span class="st">"TMAX"</span>, <span class="st">"PRCP"</span>, <span class="st">"SNOW"</span>, <span class="st">"SNWD"</span>)))</span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a><span class="fu">### Missing data</span></span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a>Next step is to check to see if there is any missing data. To do this, we can count the number of observations for each year in each respective group. We expect there to be one observation per day, so ideally approximately 365 observations per year at each location for each measurement.</span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: check-missing</span></span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a><span class="co"># check dataset for years with missing data</span></span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; count the number of days within each year that have a measurement (for all elements from each location)</span></span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a>(data_years <span class="ot">&lt;-</span> data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Location,</span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">year =</span> <span class="fu">year</span>(Date),</span>
<span id="cb55-65"><a href="#cb55-65" aria-hidden="true" tabindex="-1"></a>        Element))</span>
<span id="cb55-66"><a href="#cb55-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-67"><a href="#cb55-67" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-68"><a href="#cb55-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-69"><a href="#cb55-69" aria-hidden="true" tabindex="-1"></a>In order to find things to look into more, lets create a visual for a quick inspection of the count data.</span>
<span id="cb55-70"><a href="#cb55-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-73"><a href="#cb55-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-74"><a href="#cb55-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-days-in-year</span></span>
<span id="cb55-75"><a href="#cb55-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-76"><a href="#cb55-76" aria-hidden="true" tabindex="-1"></a><span class="co"># create plot to visualize the wide data, which represents the total number of days with observations for each year</span></span>
<span id="cb55-77"><a href="#cb55-77" aria-hidden="true" tabindex="-1"></a><span class="co"># do this for each location and element combination</span></span>
<span id="cb55-78"><a href="#cb55-78" aria-hidden="true" tabindex="-1"></a><span class="co"># add a horizontal line at 365 days, which contextually represents data collected everyday of said year</span></span>
<span id="cb55-79"><a href="#cb55-79" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb55-80"><a href="#cb55-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> year,</span>
<span id="cb55-81"><a href="#cb55-81" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> n),</span>
<span id="cb55-82"><a href="#cb55-82" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> data_years) <span class="sc">+</span> </span>
<span id="cb55-83"><a href="#cb55-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">365</span>,</span>
<span id="cb55-84"><a href="#cb55-84" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> </span>
<span id="cb55-85"><a href="#cb55-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Location <span class="sc">~</span> Element)</span>
<span id="cb55-86"><a href="#cb55-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-87"><a href="#cb55-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-88"><a href="#cb55-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-89"><a href="#cb55-89" aria-hidden="true" tabindex="-1"></a>Here are some observations:</span>
<span id="cb55-90"><a href="#cb55-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-91"><a href="#cb55-91" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>No snow data for AU.</span>
<span id="cb55-92"><a href="#cb55-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-93"><a href="#cb55-93" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>A few years with more 365 obs.</span>
<span id="cb55-94"><a href="#cb55-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-95"><a href="#cb55-95" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Only consistent full years of data for AK after around 1980.</span>
<span id="cb55-96"><a href="#cb55-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-97"><a href="#cb55-97" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Not consistent full year of data for HI beyond 2002.</span>
<span id="cb55-98"><a href="#cb55-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-99"><a href="#cb55-99" aria-hidden="true" tabindex="-1"></a>Thoughts on these:</span>
<span id="cb55-100"><a href="#cb55-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-101"><a href="#cb55-101" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Should can not work with SNOW and SNWD moving forward. This is because the final goal is to be able to visualize elements that have data for all three locations.</span>
<span id="cb55-102"><a href="#cb55-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-103"><a href="#cb55-103" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Not sure what this means, so we might want to consider removing these data points? Unclear at this time.</span>
<span id="cb55-104"><a href="#cb55-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-105"><a href="#cb55-105" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Should only use data for years 1980 and beyond for AK moving forward.</span>
<span id="cb55-106"><a href="#cb55-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-107"><a href="#cb55-107" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Should only use data up to and including year 2002 for HI moving forward.</span>
<span id="cb55-108"><a href="#cb55-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-109"><a href="#cb55-109" aria-hidden="true" tabindex="-1"></a>Now that we have visually inspected the count data, we can make some initial decisions about which data to work or not work with. Getting these out of the way before diving in more will make it easier.</span>
<span id="cb55-110"><a href="#cb55-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-113"><a href="#cb55-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-114"><a href="#cb55-114" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: keep-elements</span></span>
<span id="cb55-115"><a href="#cb55-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-116"><a href="#cb55-116" aria-hidden="true" tabindex="-1"></a><span class="co"># start refining the data</span></span>
<span id="cb55-117"><a href="#cb55-117" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; keep only the elements that are going to be visualized</span></span>
<span id="cb55-118"><a href="#cb55-118" aria-hidden="true" tabindex="-1"></a>(data_climate <span class="ot">&lt;-</span> data_clean <span class="sc">%&gt;%</span></span>
<span id="cb55-119"><a href="#cb55-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Element <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"TMIN"</span>,</span>
<span id="cb55-120"><a href="#cb55-120" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"TMAX"</span>,</span>
<span id="cb55-121"><a href="#cb55-121" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"PRCP"</span>)))</span>
<span id="cb55-122"><a href="#cb55-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-123"><a href="#cb55-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-124"><a href="#cb55-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-125"><a href="#cb55-125" aria-hidden="true" tabindex="-1"></a>Now lets look into the count data with only the desired elements to see exactly what's going on.</span>
<span id="cb55-126"><a href="#cb55-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-129"><a href="#cb55-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-130"><a href="#cb55-130" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: inspect-elements</span></span>
<span id="cb55-131"><a href="#cb55-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-132"><a href="#cb55-132" aria-hidden="true" tabindex="-1"></a><span class="co"># look further into count data</span></span>
<span id="cb55-133"><a href="#cb55-133" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to wide data to be able to compactly look at how much data there is (or is not) for each element</span></span>
<span id="cb55-134"><a href="#cb55-134" aria-hidden="true" tabindex="-1"></a><span class="co"># can also manually sort by year to look at locations within year when inspecting</span></span>
<span id="cb55-135"><a href="#cb55-135" aria-hidden="true" tabindex="-1"></a>(data_years_wide <span class="ot">&lt;-</span> data_climate <span class="sc">%&gt;%</span> </span>
<span id="cb55-136"><a href="#cb55-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Location,</span>
<span id="cb55-137"><a href="#cb55-137" aria-hidden="true" tabindex="-1"></a>        <span class="at">year =</span> <span class="fu">year</span>(Date),</span>
<span id="cb55-138"><a href="#cb55-138" aria-hidden="true" tabindex="-1"></a>        Element) <span class="sc">%&gt;%</span> </span>
<span id="cb55-139"><a href="#cb55-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"Element"</span>,</span>
<span id="cb55-140"><a href="#cb55-140" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="st">"n"</span>))</span>
<span id="cb55-141"><a href="#cb55-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-142"><a href="#cb55-142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-143"><a href="#cb55-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-144"><a href="#cb55-144" aria-hidden="true" tabindex="-1"></a>After closely looking through this representation of the count data, we can confirm the several of the observations made from the first visual. Low number of observations lead us to focus on data within locations that do not include the following years of data:</span>
<span id="cb55-145"><a href="#cb55-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-146"><a href="#cb55-146" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sets of years where there is consistently not good data.</span>
<span id="cb55-147"><a href="#cb55-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-148"><a href="#cb55-148" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>One-off years with only a few observations.</span>
<span id="cb55-149"><a href="#cb55-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-150"><a href="#cb55-150" aria-hidden="true" tabindex="-1"></a>Also note that there is no data in the original dataset from 2003 for some reason. This will obviously show up in the final visuals, but nothing that can be done about it (although measures will be taken to ensure accurate portrayals as described later).</span>
<span id="cb55-151"><a href="#cb55-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-154"><a href="#cb55-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-155"><a href="#cb55-155" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: remove-years</span></span>
<span id="cb55-156"><a href="#cb55-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-157"><a href="#cb55-157" aria-hidden="true" tabindex="-1"></a><span class="co"># continue refining climate data to move forward with</span></span>
<span id="cb55-158"><a href="#cb55-158" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; remove years with not good data</span></span>
<span id="cb55-159"><a href="#cb55-159" aria-hidden="true" tabindex="-1"></a>(data_climate <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb55-160"><a href="#cb55-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(Location <span class="sc">==</span> <span class="st">"AK"</span> <span class="sc">&amp;</span> (<span class="fu">year</span>(Date) <span class="sc">&lt;</span> <span class="dv">1980</span> <span class="sc">|</span> <span class="fu">year</span>(Date) <span class="sc">==</span> <span class="dv">2019</span>)),</span>
<span id="cb55-161"><a href="#cb55-161" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>(Location <span class="sc">==</span> <span class="st">"AU"</span> <span class="sc">&amp;</span> (<span class="fu">year</span>(Date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1970</span>, <span class="dv">2019</span>))),</span>
<span id="cb55-162"><a href="#cb55-162" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>(Location <span class="sc">==</span> <span class="st">"HI"</span> <span class="sc">&amp;</span> (<span class="fu">year</span>(Date) <span class="sc">&gt;</span> <span class="dv">2002</span> <span class="sc">|</span> <span class="fu">year</span>(Date) <span class="sc">==</span> <span class="dv">1950</span>))))</span>
<span id="cb55-163"><a href="#cb55-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-164"><a href="#cb55-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-165"><a href="#cb55-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-166"><a href="#cb55-166" aria-hidden="true" tabindex="-1"></a><span class="fu">### Extra observations</span></span>
<span id="cb55-167"><a href="#cb55-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-168"><a href="#cb55-168" aria-hidden="true" tabindex="-1"></a>Now lets look into data from 2004. As of now, we are not sure why there are multiple observations for each date across all elements.</span>
<span id="cb55-169"><a href="#cb55-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-172"><a href="#cb55-172" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-173"><a href="#cb55-173" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: check_data_2004</span></span>
<span id="cb55-174"><a href="#cb55-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-175"><a href="#cb55-175" aria-hidden="true" tabindex="-1"></a><span class="co"># confirm this by counting the number of observations per day for each element / location combo</span></span>
<span id="cb55-176"><a href="#cb55-176" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; filter to only 2004 data</span></span>
<span id="cb55-177"><a href="#cb55-177" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; split into dataframe subsets for each element</span></span>
<span id="cb55-178"><a href="#cb55-178" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; do the counting on each subset</span></span>
<span id="cb55-179"><a href="#cb55-179" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; combine results into an organized dataframe</span></span>
<span id="cb55-180"><a href="#cb55-180" aria-hidden="true" tabindex="-1"></a>(data_2004_check <span class="ot">&lt;-</span> data_climate <span class="sc">%&gt;%</span> </span>
<span id="cb55-181"><a href="#cb55-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Date) <span class="sc">==</span> <span class="dv">2004</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-182"><a href="#cb55-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(.<span class="sc">$</span>Element) <span class="sc">%&gt;%</span> </span>
<span id="cb55-183"><a href="#cb55-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mclapply</span>(<span class="at">FUN =</span> <span class="cf">function</span>(element_data) {</span>
<span id="cb55-184"><a href="#cb55-184" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-185"><a href="#cb55-185" aria-hidden="true" tabindex="-1"></a>    <span class="co"># count the number of rows per day</span></span>
<span id="cb55-186"><a href="#cb55-186" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add back in the element info for when combining the results later</span></span>
<span id="cb55-187"><a href="#cb55-187" aria-hidden="true" tabindex="-1"></a>    element_data <span class="sc">%&gt;%</span> </span>
<span id="cb55-188"><a href="#cb55-188" aria-hidden="true" tabindex="-1"></a>      <span class="fu">count</span>(Location, Date) <span class="sc">%&gt;%</span> </span>
<span id="cb55-189"><a href="#cb55-189" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Element =</span> <span class="fu">unique</span>(element_data<span class="sc">$</span>Element))</span>
<span id="cb55-190"><a href="#cb55-190" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-191"><a href="#cb55-191" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">mc.cores =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-192"><a href="#cb55-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Reduce</span>(<span class="at">f =</span> bind_rows, <span class="at">x =</span> .))</span>
<span id="cb55-193"><a href="#cb55-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-194"><a href="#cb55-194" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-195"><a href="#cb55-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-196"><a href="#cb55-196" aria-hidden="true" tabindex="-1"></a>We see $n = 2$, so multiple observations for each day is confirmed. To consolidate these, we are going to average all observations from a single day. This is to have just a single value per day, which will ensure that each day has the same weight when taking monthly averages later. If one day has more than one record, then it would be like there is an extra day, which is an inaccurate interpretation.</span>
<span id="cb55-197"><a href="#cb55-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-200"><a href="#cb55-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-201"><a href="#cb55-201" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: adjust_data_2004</span></span>
<span id="cb55-202"><a href="#cb55-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-203"><a href="#cb55-203" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust data from 2004</span></span>
<span id="cb55-204"><a href="#cb55-204" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; filter climate data to only 2004</span></span>
<span id="cb55-205"><a href="#cb55-205" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; group by identifying variables</span></span>
<span id="cb55-206"><a href="#cb55-206" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; average the multiple observations</span></span>
<span id="cb55-207"><a href="#cb55-207" aria-hidden="true" tabindex="-1"></a>(data_2004 <span class="ot">&lt;-</span> data_climate <span class="sc">%&gt;%</span> </span>
<span id="cb55-208"><a href="#cb55-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Date) <span class="sc">==</span> <span class="dv">2004</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-209"><a href="#cb55-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Element, Location, Date) <span class="sc">%&gt;%</span> </span>
<span id="cb55-210"><a href="#cb55-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Value =</span> <span class="fu">mean</span>(Value)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-211"><a href="#cb55-211" aria-hidden="true" tabindex="-1"></a>  ungroup)</span>
<span id="cb55-212"><a href="#cb55-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-213"><a href="#cb55-213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-214"><a href="#cb55-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-215"><a href="#cb55-215" aria-hidden="true" tabindex="-1"></a>Now lets count the adjusted data to confirm that is has been correctly addressed.</span>
<span id="cb55-216"><a href="#cb55-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-219"><a href="#cb55-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-220"><a href="#cb55-220" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: recheck_data_2004</span></span>
<span id="cb55-221"><a href="#cb55-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-222"><a href="#cb55-222" aria-hidden="true" tabindex="-1"></a><span class="co"># now run the summarized data back through the checking procedure to confirm that there is now only one obs per day</span></span>
<span id="cb55-223"><a href="#cb55-223" aria-hidden="true" tabindex="-1"></a>(data_2004_recheck <span class="ot">&lt;-</span> data_2004 <span class="sc">%&gt;%</span> </span>
<span id="cb55-224"><a href="#cb55-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(.<span class="sc">$</span>Element) <span class="sc">%&gt;%</span> </span>
<span id="cb55-225"><a href="#cb55-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mclapply</span>(<span class="at">FUN =</span> <span class="cf">function</span>(element_data) {</span>
<span id="cb55-226"><a href="#cb55-226" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-227"><a href="#cb55-227" aria-hidden="true" tabindex="-1"></a>    element_data <span class="sc">%&gt;%</span> </span>
<span id="cb55-228"><a href="#cb55-228" aria-hidden="true" tabindex="-1"></a>      <span class="fu">count</span>(Location, Date) <span class="sc">%&gt;%</span> </span>
<span id="cb55-229"><a href="#cb55-229" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Element =</span> <span class="fu">unique</span>(element_data<span class="sc">$</span>Element))</span>
<span id="cb55-230"><a href="#cb55-230" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-231"><a href="#cb55-231" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">mc.cores =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-232"><a href="#cb55-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Reduce</span>(<span class="at">f =</span> bind_rows, <span class="at">x =</span> .))</span>
<span id="cb55-233"><a href="#cb55-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-234"><a href="#cb55-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-235"><a href="#cb55-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-236"><a href="#cb55-236" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final modifications</span></span>
<span id="cb55-237"><a href="#cb55-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-238"><a href="#cb55-238" aria-hidden="true" tabindex="-1"></a>Now can make the final refinements to the climate dataset.</span>
<span id="cb55-239"><a href="#cb55-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-242"><a href="#cb55-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-243"><a href="#cb55-243" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: more-data-manipulations</span></span>
<span id="cb55-244"><a href="#cb55-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-245"><a href="#cb55-245" aria-hidden="true" tabindex="-1"></a><span class="co"># now continue with refining climate dataset</span></span>
<span id="cb55-246"><a href="#cb55-246" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; remove original 2004 data</span></span>
<span id="cb55-247"><a href="#cb55-247" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; add in the corrected 2004 data to the rest of the correct data</span></span>
<span id="cb55-248"><a href="#cb55-248" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; sort in a logical way</span></span>
<span id="cb55-249"><a href="#cb55-249" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; adjust values to have readable units (originally in 10ths of degrees and 10ths of mm)</span></span>
<span id="cb55-250"><a href="#cb55-250" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; remove original value variable</span></span>
<span id="cb55-251"><a href="#cb55-251" aria-hidden="true" tabindex="-1"></a><span class="co"># this is a final plotting dataset as well as the base dataset that future datasets start with </span></span>
<span id="cb55-252"><a href="#cb55-252" aria-hidden="true" tabindex="-1"></a>(data_climate <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb55-253"><a href="#cb55-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Date) <span class="sc">!=</span> <span class="dv">2004</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-254"><a href="#cb55-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(data_2004) <span class="sc">%&gt;%</span> </span>
<span id="cb55-255"><a href="#cb55-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Element, Location, Date) <span class="sc">%&gt;%</span> </span>
<span id="cb55-256"><a href="#cb55-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> Value <span class="sc">/</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-257"><a href="#cb55-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Value))</span>
<span id="cb55-258"><a href="#cb55-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-259"><a href="#cb55-259" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-260"><a href="#cb55-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-261"><a href="#cb55-261" aria-hidden="true" tabindex="-1"></a>As a final confirmation, lets recreate the first visual with the new refined dataset.</span>
<span id="cb55-262"><a href="#cb55-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-265"><a href="#cb55-265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-266"><a href="#cb55-266" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: check-final-data</span></span>
<span id="cb55-267"><a href="#cb55-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-268"><a href="#cb55-268" aria-hidden="true" tabindex="-1"></a><span class="co"># check years for final dataset by running the data through the counting and plotting process from above</span></span>
<span id="cb55-269"><a href="#cb55-269" aria-hidden="true" tabindex="-1"></a>data_climate <span class="sc">%&gt;%</span> </span>
<span id="cb55-270"><a href="#cb55-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Location,</span>
<span id="cb55-271"><a href="#cb55-271" aria-hidden="true" tabindex="-1"></a>        <span class="at">year =</span> <span class="fu">year</span>(Date),</span>
<span id="cb55-272"><a href="#cb55-272" aria-hidden="true" tabindex="-1"></a>        Element) <span class="sc">%&gt;%</span> </span>
<span id="cb55-273"><a href="#cb55-273" aria-hidden="true" tabindex="-1"></a>  {<span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb55-274"><a href="#cb55-274" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> year,</span>
<span id="cb55-275"><a href="#cb55-275" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> n),</span>
<span id="cb55-276"><a href="#cb55-276" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> .) <span class="sc">+</span> </span>
<span id="cb55-277"><a href="#cb55-277" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">365</span>,</span>
<span id="cb55-278"><a href="#cb55-278" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> </span>
<span id="cb55-279"><a href="#cb55-279" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">400</span>)) <span class="sc">+</span> </span>
<span id="cb55-280"><a href="#cb55-280" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_grid</span>(Location <span class="sc">~</span> Element)}</span>
<span id="cb55-281"><a href="#cb55-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-282"><a href="#cb55-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-283"><a href="#cb55-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-284"><a href="#cb55-284" aria-hidden="true" tabindex="-1"></a>So now we have a dataset that contains data only from the elements of interest and the valid years for each respective location and correct units. It is now ready to be modified as needed for the desired visuals.</span>
<span id="cb55-285"><a href="#cb55-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-286"><a href="#cb55-286" aria-hidden="true" tabindex="-1"></a><span class="fu">## Create visualization data</span></span>
<span id="cb55-287"><a href="#cb55-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-288"><a href="#cb55-288" aria-hidden="true" tabindex="-1"></a>With an idea of the final visuals in mine, we can start to construct the needed data for each feature of the plot.</span>
<span id="cb55-289"><a href="#cb55-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-290"><a href="#cb55-290" aria-hidden="true" tabindex="-1"></a><span class="fu">### Monthly averages</span></span>
<span id="cb55-291"><a href="#cb55-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-292"><a href="#cb55-292" aria-hidden="true" tabindex="-1"></a>First is the monthly averages for each month within each location.</span>
<span id="cb55-293"><a href="#cb55-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-296"><a href="#cb55-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-297"><a href="#cb55-297" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-monthly-average</span></span>
<span id="cb55-298"><a href="#cb55-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-299"><a href="#cb55-299" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataset that contains average values for each month by location</span></span>
<span id="cb55-300"><a href="#cb55-300" aria-hidden="true" tabindex="-1"></a><span class="co"># this is a final plotting dataset</span></span>
<span id="cb55-301"><a href="#cb55-301" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; extract the year and month of the date for grouping purposes </span></span>
<span id="cb55-302"><a href="#cb55-302" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; set day to be the last day of each month and average the values for each month</span></span>
<span id="cb55-303"><a href="#cb55-303" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; combine individual date related variables back into a full date variable and create a grouping variable (which is just for the line plot) that defines whether a time point is before or after the missing year (2003) of data </span></span>
<span id="cb55-304"><a href="#cb55-304" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; select only the now wanted variables</span></span>
<span id="cb55-305"><a href="#cb55-305" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; had to ungroup in prior step so that year and month aren't automatically included in the select statement by dplyr</span></span>
<span id="cb55-306"><a href="#cb55-306" aria-hidden="true" tabindex="-1"></a>(data_monlthy_avg <span class="ot">&lt;-</span> data_climate <span class="sc">%&gt;%</span> </span>
<span id="cb55-307"><a href="#cb55-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(Date),</span>
<span id="cb55-308"><a href="#cb55-308" aria-hidden="true" tabindex="-1"></a>         <span class="at">month =</span> <span class="fu">month</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-309"><a href="#cb55-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Location,</span>
<span id="cb55-310"><a href="#cb55-310" aria-hidden="true" tabindex="-1"></a>           year,</span>
<span id="cb55-311"><a href="#cb55-311" aria-hidden="true" tabindex="-1"></a>           month,</span>
<span id="cb55-312"><a href="#cb55-312" aria-hidden="true" tabindex="-1"></a>           Element) <span class="sc">%&gt;%</span> </span>
<span id="cb55-313"><a href="#cb55-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">day =</span> <span class="fu">max</span>(<span class="fu">day</span>(Date)),</span>
<span id="cb55-314"><a href="#cb55-314" aria-hidden="true" tabindex="-1"></a>            <span class="at">value_avg =</span> <span class="fu">round</span>(<span class="fu">mean</span>(value), <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-315"><a href="#cb55-315" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb55-316"><a href="#cb55-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ymd</span>(<span class="fu">paste</span>(year, month, day, <span class="at">sep =</span> <span class="st">"-"</span>)),</span>
<span id="cb55-317"><a href="#cb55-317" aria-hidden="true" tabindex="-1"></a>         <span class="at">line_plot_group =</span> <span class="fu">ifelse</span>(<span class="at">test =</span> year <span class="sc">&lt;</span> <span class="dv">2003</span>,</span>
<span id="cb55-318"><a href="#cb55-318" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yes =</span> <span class="dv">1</span>,</span>
<span id="cb55-319"><a href="#cb55-319" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">no =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-320"><a href="#cb55-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Location,</span>
<span id="cb55-321"><a href="#cb55-321" aria-hidden="true" tabindex="-1"></a>         date,</span>
<span id="cb55-322"><a href="#cb55-322" aria-hidden="true" tabindex="-1"></a>         Element,</span>
<span id="cb55-323"><a href="#cb55-323" aria-hidden="true" tabindex="-1"></a>         value_avg,</span>
<span id="cb55-324"><a href="#cb55-324" aria-hidden="true" tabindex="-1"></a>         line_plot_group))</span>
<span id="cb55-325"><a href="#cb55-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-326"><a href="#cb55-326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-327"><a href="#cb55-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-328"><a href="#cb55-328" aria-hidden="true" tabindex="-1"></a><span class="fu">### Projections</span></span>
<span id="cb55-329"><a href="#cb55-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-330"><a href="#cb55-330" aria-hidden="true" tabindex="-1"></a>Now we are going to create the dataset to model the different types of projections that will be included in the final plot. This requires several intermediate datasets before they can be combined into a final projections dataset. Below is the first one, which will contain information about the intitial average values to be used for comparison purposes.</span>
<span id="cb55-331"><a href="#cb55-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-334"><a href="#cb55-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-335"><a href="#cb55-335" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-projections</span></span>
<span id="cb55-336"><a href="#cb55-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-337"><a href="#cb55-337" aria-hidden="true" tabindex="-1"></a><span class="co"># create a dataset that will be used to plot a horizontal line</span></span>
<span id="cb55-338"><a href="#cb55-338" aria-hidden="true" tabindex="-1"></a><span class="co"># this is an intermediate dataset for the final plotting data</span></span>
<span id="cb55-339"><a href="#cb55-339" aria-hidden="true" tabindex="-1"></a><span class="co"># the y value should equal the average value during first five years of data collection</span></span>
<span id="cb55-340"><a href="#cb55-340" aria-hidden="true" tabindex="-1"></a><span class="co"># and the x values will be the first and last dates of data collection so that the line spans the entire time frame</span></span>
<span id="cb55-341"><a href="#cb55-341" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; group by element and location (so the next calculations are group-wise)</span></span>
<span id="cb55-342"><a href="#cb55-342" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; calculate year, the minimum year (in order to get the limit year for the 5 year avg) and the exact first and last dates of data collection</span></span>
<span id="cb55-343"><a href="#cb55-343" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; filter data to only observations in the first 5 years of data collection</span></span>
<span id="cb55-344"><a href="#cb55-344" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; group by again, we need to group by first and last date as well in order to keep those columns (it doesn't affect the following summarizing calculations)</span></span>
<span id="cb55-345"><a href="#cb55-345" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; calculate the average temps for each location</span></span>
<span id="cb55-346"><a href="#cb55-346" aria-hidden="true" tabindex="-1"></a>(data_baseline <span class="ot">&lt;-</span> data_climate <span class="sc">%&gt;%</span> </span>
<span id="cb55-347"><a href="#cb55-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Element, </span>
<span id="cb55-348"><a href="#cb55-348" aria-hidden="true" tabindex="-1"></a>           Location) <span class="sc">%&gt;%</span> </span>
<span id="cb55-349"><a href="#cb55-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(Date),</span>
<span id="cb55-350"><a href="#cb55-350" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_first =</span> <span class="fu">min</span>(year),</span>
<span id="cb55-351"><a href="#cb55-351" aria-hidden="true" tabindex="-1"></a>         <span class="at">date_first =</span> <span class="fu">min</span>(Date),</span>
<span id="cb55-352"><a href="#cb55-352" aria-hidden="true" tabindex="-1"></a>         <span class="at">date_last =</span> <span class="fu">max</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-353"><a href="#cb55-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;</span> year_first <span class="sc">+</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-354"><a href="#cb55-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Element,</span>
<span id="cb55-355"><a href="#cb55-355" aria-hidden="true" tabindex="-1"></a>           Location,</span>
<span id="cb55-356"><a href="#cb55-356" aria-hidden="true" tabindex="-1"></a>           date_first,</span>
<span id="cb55-357"><a href="#cb55-357" aria-hidden="true" tabindex="-1"></a>           date_last) <span class="sc">%&gt;%</span> </span>
<span id="cb55-358"><a href="#cb55-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value_5avg =</span> <span class="fu">round</span>(<span class="fu">mean</span>(value), <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-359"><a href="#cb55-359" aria-hidden="true" tabindex="-1"></a>  ungroup)</span>
<span id="cb55-360"><a href="#cb55-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-361"><a href="#cb55-361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-362"><a href="#cb55-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-363"><a href="#cb55-363" aria-hidden="true" tabindex="-1"></a>Next is the second intermediate dataset, which will capture information based on a smooth curve fitted to the daily data.</span>
<span id="cb55-364"><a href="#cb55-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-367"><a href="#cb55-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-368"><a href="#cb55-368" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-late-pred</span></span>
<span id="cb55-369"><a href="#cb55-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-370"><a href="#cb55-370" aria-hidden="true" tabindex="-1"></a><span class="co"># goal is to get the predicted value from the last day of data collection based off some model</span></span>
<span id="cb55-371"><a href="#cb55-371" aria-hidden="true" tabindex="-1"></a><span class="co"># going to do loess regression with response as value (value) and predictor as number of days after (days_since) a round arbitrary start date (01/01/1950) that is before earliest data point </span></span>
<span id="cb55-372"><a href="#cb55-372" aria-hidden="true" tabindex="-1"></a><span class="co"># this is an intermediate dataset for the final plotting data</span></span>
<span id="cb55-373"><a href="#cb55-373" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; calculate explanatory variable</span></span>
<span id="cb55-374"><a href="#cb55-374" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; split dataset into a list with an element for each unique Location / Element combo</span></span>
<span id="cb55-375"><a href="#cb55-375" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; run lapply for each element that does the following:</span></span>
<span id="cb55-376"><a href="#cb55-376" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; fits a model and all extract predictions</span></span>
<span id="cb55-377"><a href="#cb55-377" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; then create and return a dataframe that contains only the final predicted value and the location / element information</span></span>
<span id="cb55-378"><a href="#cb55-378" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; finally combine each returned one-row dataframes into a single dataframe</span></span>
<span id="cb55-379"><a href="#cb55-379" aria-hidden="true" tabindex="-1"></a>(data_last_pred <span class="ot">&lt;-</span> data_climate <span class="sc">%&gt;%</span> </span>
<span id="cb55-380"><a href="#cb55-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">days_since =</span> <span class="fu">as.numeric</span>(Date <span class="sc">-</span> <span class="fu">ymd</span>(<span class="st">"1950-01-01"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb55-381"><a href="#cb55-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(<span class="at">f =</span> <span class="fu">paste</span>(.<span class="sc">$</span>Location, </span>
<span id="cb55-382"><a href="#cb55-382" aria-hidden="true" tabindex="-1"></a>                  .<span class="sc">$</span>Element,</span>
<span id="cb55-383"><a href="#cb55-383" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-384"><a href="#cb55-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mclapply</span>(<span class="at">FUN =</span> <span class="cf">function</span>(climate_data) {</span>
<span id="cb55-385"><a href="#cb55-385" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-386"><a href="#cb55-386" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit loess model with specified response and predictor</span></span>
<span id="cb55-387"><a href="#cb55-387" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -&gt; the model fit here matches what will be done with geom_smooth() in the final plot</span></span>
<span id="cb55-388"><a href="#cb55-388" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -&gt; so using the same model parameters, which is span = 2 and is largerish more robust so that the smoothed line is not too fine / jaggedy (want it to be a smooth curve for visual purposes)</span></span>
<span id="cb55-389"><a href="#cb55-389" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">=</span> <span class="fu">loess</span>(<span class="at">formula =</span> value <span class="sc">~</span> days_since,</span>
<span id="cb55-390"><a href="#cb55-390" aria-hidden="true" tabindex="-1"></a>                  <span class="at">span =</span> <span class="dv">2</span>,</span>
<span id="cb55-391"><a href="#cb55-391" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> climate_data)</span>
<span id="cb55-392"><a href="#cb55-392" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-393"><a href="#cb55-393" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract predicted values across all xs</span></span>
<span id="cb55-394"><a href="#cb55-394" aria-hidden="true" tabindex="-1"></a>    preds <span class="ot">=</span> <span class="fu">predict</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb55-395"><a href="#cb55-395" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb55-396"><a href="#cb55-396" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-397"><a href="#cb55-397" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create an organized one-row organized dataframe to return</span></span>
<span id="cb55-398"><a href="#cb55-398" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -&gt; reduce modeling dataset to just one row that contains that needed id information</span></span>
<span id="cb55-399"><a href="#cb55-399" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -&gt; extract just the last predicted value</span></span>
<span id="cb55-400"><a href="#cb55-400" aria-hidden="true" tabindex="-1"></a>    climate_data <span class="sc">%&gt;%</span> </span>
<span id="cb55-401"><a href="#cb55-401" aria-hidden="true" tabindex="-1"></a>      <span class="fu">distinct</span>(Location,</span>
<span id="cb55-402"><a href="#cb55-402" aria-hidden="true" tabindex="-1"></a>               Element) <span class="sc">%&gt;%</span> </span>
<span id="cb55-403"><a href="#cb55-403" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">last_pred =</span> <span class="fu">tail</span>(preds, <span class="at">n =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-404"><a href="#cb55-404" aria-hidden="true" tabindex="-1"></a>      return</span>
<span id="cb55-405"><a href="#cb55-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-406"><a href="#cb55-406" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">mc.cores =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-407"><a href="#cb55-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Reduce</span>(<span class="at">f =</span> bind_rows, <span class="at">x =</span> .))</span>
<span id="cb55-408"><a href="#cb55-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-409"><a href="#cb55-409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-410"><a href="#cb55-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-411"><a href="#cb55-411" aria-hidden="true" tabindex="-1"></a>Now we can combine both the initial average info and the predictions from the model into the final projections dataset.</span>
<span id="cb55-412"><a href="#cb55-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-415"><a href="#cb55-415" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-416"><a href="#cb55-416" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-projections-final</span></span>
<span id="cb55-417"><a href="#cb55-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-418"><a href="#cb55-418" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataset that contains all of the information related to projections, both the simple baseline average and the fancy model</span></span>
<span id="cb55-419"><a href="#cb55-419" aria-hidden="true" tabindex="-1"></a><span class="co"># this is a final plotting dataset</span></span>
<span id="cb55-420"><a href="#cb55-420" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; add info about the final predicted value to the baseline data</span></span>
<span id="cb55-421"><a href="#cb55-421" aria-hidden="true" tabindex="-1"></a><span class="co"># now need to create the information about the error bar, which will summarize the differences between the two different projection methods</span></span>
<span id="cb55-422"><a href="#cb55-422" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; do the following calculations:</span></span>
<span id="cb55-423"><a href="#cb55-423" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; difference between the two final predictions</span></span>
<span id="cb55-424"><a href="#cb55-424" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; sign of difference (for the label)</span></span>
<span id="cb55-425"><a href="#cb55-425" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; character string of formatted error label</span></span>
<span id="cb55-426"><a href="#cb55-426" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; location of midpoint of errorbar, which will be the y value of the label position on the final plot</span></span>
<span id="cb55-427"><a href="#cb55-427" aria-hidden="true" tabindex="-1"></a>(data_projections <span class="ot">&lt;-</span> data_baseline <span class="sc">%&gt;%</span> </span>
<span id="cb55-428"><a href="#cb55-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_last_pred, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Element"</span>, <span class="st">"Location"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-429"><a href="#cb55-429" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb55-430"><a href="#cb55-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">error =</span> <span class="fu">round</span>(last_pred <span class="sc">-</span> value_5avg, <span class="dv">2</span>),</span>
<span id="cb55-431"><a href="#cb55-431" aria-hidden="true" tabindex="-1"></a>         <span class="at">error_sign =</span> <span class="fu">ifelse</span>(error <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"+"</span>, <span class="st">"-"</span>),</span>
<span id="cb55-432"><a href="#cb55-432" aria-hidden="true" tabindex="-1"></a>         <span class="at">error_label =</span> <span class="fu">paste</span>(<span class="fu">ifelse</span>(error_sign <span class="sc">==</span> <span class="st">"+"</span>, <span class="st">"+"</span>, <span class="st">""</span>),</span>
<span id="cb55-433"><a href="#cb55-433" aria-hidden="true" tabindex="-1"></a>                       error,</span>
<span id="cb55-434"><a href="#cb55-434" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"˚"</span>,</span>
<span id="cb55-435"><a href="#cb55-435" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb55-436"><a href="#cb55-436" aria-hidden="true" tabindex="-1"></a>         <span class="at">error_midpoint =</span> <span class="fu">round</span>((last_pred <span class="sc">+</span> value_5avg) <span class="sc">/</span> <span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb55-437"><a href="#cb55-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-438"><a href="#cb55-438" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-439"><a href="#cb55-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-440"><a href="#cb55-440" aria-hidden="true" tabindex="-1"></a><span class="fu">### Window setting</span></span>
<span id="cb55-441"><a href="#cb55-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-442"><a href="#cb55-442" aria-hidden="true" tabindex="-1"></a>Because the impact of the final visuals depends heavily on visual comparisons, much care is needed to be taken in terms of the $y$ scales on each plot. Here is the thought process:</span>
<span id="cb55-443"><a href="#cb55-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-444"><a href="#cb55-444" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When facetting with "free_y" scales for each location, visual comparisons of the error bars may be misleading. For accurate visual comparisons of the errors, the total range for each $y$ scale needs to be the same (so the error bars are correctly proportional).</span>
<span id="cb55-445"><a href="#cb55-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-446"><a href="#cb55-446" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"free_y" scales with facets will correctly position the limits for each panel's data, but some data could appear to be zoomed in if the range for $y$ scale is smaller.</span>
<span id="cb55-447"><a href="#cb55-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-448"><a href="#cb55-448" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>So we are going to figure out the maximum range between the largest and smallest avg monthly value (for each location). And then use that same range (and approximately centered around each respective baseline) for the other two locations.</span>
<span id="cb55-449"><a href="#cb55-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-450"><a href="#cb55-450" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>As a result of the same range effect, the variability in monthly avg values will be presented correctly as well. So this info will be represented as a pair of $(x,y)$ coordinates at the desired edges of the values' scales.</span>
<span id="cb55-451"><a href="#cb55-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-452"><a href="#cb55-452" aria-hidden="true" tabindex="-1"></a>Now lets create a dataset that can reflect the conclusion we arrived at.</span>
<span id="cb55-453"><a href="#cb55-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-456"><a href="#cb55-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-457"><a href="#cb55-457" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-windows</span></span>
<span id="cb55-458"><a href="#cb55-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-459"><a href="#cb55-459" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataset with the information needed for y limits of each panel</span></span>
<span id="cb55-460"><a href="#cb55-460" aria-hidden="true" tabindex="-1"></a><span class="co"># this is a final plotting dataset </span></span>
<span id="cb55-461"><a href="#cb55-461" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; start with the monthly average values dataset because that data defines the y scale </span></span>
<span id="cb55-462"><a href="#cb55-462" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; group by element and location</span></span>
<span id="cb55-463"><a href="#cb55-463" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; figure out the min, max and range (max - min) values for each</span></span>
<span id="cb55-464"><a href="#cb55-464" aria-hidden="true" tabindex="-1"></a><span class="co"># now find the max range for each element</span></span>
<span id="cb55-465"><a href="#cb55-465" aria-hidden="true" tabindex="-1"></a><span class="co"># summarizing over Location because we want to the overall max as the new common max</span></span>
<span id="cb55-466"><a href="#cb55-466" aria-hidden="true" tabindex="-1"></a><span class="co"># do this by splitting the dataframe by element and an lapply that does the following on each subset:</span></span>
<span id="cb55-467"><a href="#cb55-467" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; figures out the max range</span></span>
<span id="cb55-468"><a href="#cb55-468" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; adds this info to the original subset with a join</span></span>
<span id="cb55-469"><a href="#cb55-469" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; then combine resulting dataframes back into one overall dataframe</span></span>
<span id="cb55-470"><a href="#cb55-470" aria-hidden="true" tabindex="-1"></a><span class="co"># now we are going to add in the information about the baseline average</span></span>
<span id="cb55-471"><a href="#cb55-471" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; use a join, just want the first date and 5 year avg info from the baseline info</span></span>
<span id="cb55-472"><a href="#cb55-472" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; select and reorder info so can figure out how to set limits</span></span>
<span id="cb55-473"><a href="#cb55-473" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; add width info to baseline dataset</span></span>
<span id="cb55-474"><a href="#cb55-474" aria-hidden="true" tabindex="-1"></a><span class="co"># manually set bounds for each panels window (just looked at numbers and set window bounds strategically)</span></span>
<span id="cb55-475"><a href="#cb55-475" aria-hidden="true" tabindex="-1"></a><span class="co"># did this according to the following strategy (for each element):</span></span>
<span id="cb55-476"><a href="#cb55-476" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; window for each panel (location) needs to be the same as the overall max range so that can compare error bars accurately</span></span>
<span id="cb55-477"><a href="#cb55-477" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; and preferably centered around the 5 year average, just for aesthetic purposes</span></span>
<span id="cb55-478"><a href="#cb55-478" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; add this via numeric constants in a mutate statement</span></span>
<span id="cb55-479"><a href="#cb55-479" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; note that rain fall has a natural lower bound of zero, so curves wont really be centered in the windows</span></span>
<span id="cb55-480"><a href="#cb55-480" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; and windows for rain are quite large (relative to values for AK and AU) because of the high variability in HI</span></span>
<span id="cb55-481"><a href="#cb55-481" aria-hidden="true" tabindex="-1"></a><span class="co"># now want to format data so that it can be handled by ggplot and the facets</span></span>
<span id="cb55-482"><a href="#cb55-482" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; convert to to tall data, creating a column for the value of the bound and which window it corresponds to (lower / upper)</span></span>
<span id="cb55-483"><a href="#cb55-483" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; keep only needed variables</span></span>
<span id="cb55-484"><a href="#cb55-484" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; going to use the the first day of data collection as the x coordinate, it's just an arbitrary choice</span></span>
<span id="cb55-485"><a href="#cb55-485" aria-hidden="true" tabindex="-1"></a>(data_y_limits <span class="ot">&lt;-</span> data_monlthy_avg <span class="sc">%&gt;%</span> </span>
<span id="cb55-486"><a href="#cb55-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Element,</span>
<span id="cb55-487"><a href="#cb55-487" aria-hidden="true" tabindex="-1"></a>           Location) <span class="sc">%&gt;%</span> </span>
<span id="cb55-488"><a href="#cb55-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="at">.cols =</span> value_avg,</span>
<span id="cb55-489"><a href="#cb55-489" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="fu">c</span>(<span class="st">"min"</span> <span class="ot">=</span> min, <span class="st">"max"</span> <span class="ot">=</span> max),</span>
<span id="cb55-490"><a href="#cb55-490" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">"{.fn}"</span>),</span>
<span id="cb55-491"><a href="#cb55-491" aria-hidden="true" tabindex="-1"></a>            <span class="at">range =</span> <span class="fu">diff</span>(<span class="fu">range</span>(value_avg))) <span class="sc">%&gt;%</span> </span>
<span id="cb55-492"><a href="#cb55-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(<span class="at">f =</span> .<span class="sc">$</span>Element) <span class="sc">%&gt;%</span> </span>
<span id="cb55-493"><a href="#cb55-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mclapply</span>(<span class="at">FUN =</span> <span class="cf">function</span>(avg_data) {</span>
<span id="cb55-494"><a href="#cb55-494" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-495"><a href="#cb55-495" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -&gt; calculate the maximum range across locations</span></span>
<span id="cb55-496"><a href="#cb55-496" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -&gt; then add back in original info</span></span>
<span id="cb55-497"><a href="#cb55-497" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -&gt; remove individual location range values</span></span>
<span id="cb55-498"><a href="#cb55-498" aria-hidden="true" tabindex="-1"></a>    avg_data <span class="sc">%&gt;%</span> </span>
<span id="cb55-499"><a href="#cb55-499" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">max_range =</span> <span class="fu">max</span>(range)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-500"><a href="#cb55-500" aria-hidden="true" tabindex="-1"></a>      <span class="fu">right_join</span>(avg_data,</span>
<span id="cb55-501"><a href="#cb55-501" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by =</span> <span class="st">"Element"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-502"><a href="#cb55-502" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>range) <span class="sc">%&gt;%</span> </span>
<span id="cb55-503"><a href="#cb55-503" aria-hidden="true" tabindex="-1"></a>      return</span>
<span id="cb55-504"><a href="#cb55-504" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-505"><a href="#cb55-505" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">mc.cores =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-506"><a href="#cb55-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Reduce</span>(<span class="at">f =</span> bind_rows,</span>
<span id="cb55-507"><a href="#cb55-507" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> .) <span class="sc">%&gt;%</span>  </span>
<span id="cb55-508"><a href="#cb55-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(data_baseline,</span>
<span id="cb55-509"><a href="#cb55-509" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Element"</span>,</span>
<span id="cb55-510"><a href="#cb55-510" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Location"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-511"><a href="#cb55-511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Element,</span>
<span id="cb55-512"><a href="#cb55-512" aria-hidden="true" tabindex="-1"></a>         Location,</span>
<span id="cb55-513"><a href="#cb55-513" aria-hidden="true" tabindex="-1"></a>         date_first,</span>
<span id="cb55-514"><a href="#cb55-514" aria-hidden="true" tabindex="-1"></a>         min,</span>
<span id="cb55-515"><a href="#cb55-515" aria-hidden="true" tabindex="-1"></a>         max,</span>
<span id="cb55-516"><a href="#cb55-516" aria-hidden="true" tabindex="-1"></a>         max_range,</span>
<span id="cb55-517"><a href="#cb55-517" aria-hidden="true" tabindex="-1"></a>         value_5avg) <span class="sc">%&gt;%</span> </span>
<span id="cb55-518"><a href="#cb55-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lower =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb55-519"><a href="#cb55-519" aria-hidden="true" tabindex="-1"></a>                   <span class="sc">-</span><span class="dv">13</span>,<span class="fl">3.7</span>,<span class="fl">10.1</span>,</span>
<span id="cb55-520"><a href="#cb55-520" aria-hidden="true" tabindex="-1"></a>                   <span class="sc">-</span><span class="dv">20</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="fl">2.8</span>),</span>
<span id="cb55-521"><a href="#cb55-521" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper =</span> <span class="fu">c</span>(<span class="dv">35</span>,<span class="dv">35</span>,<span class="dv">35</span>,</span>
<span id="cb55-522"><a href="#cb55-522" aria-hidden="true" tabindex="-1"></a>                   <span class="fl">20.8</span>,<span class="fl">37.5</span>,<span class="fl">43.9</span>,</span>
<span id="cb55-523"><a href="#cb55-523" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">12</span>,<span class="fl">25.8</span>,<span class="fl">33.6</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-524"><a href="#cb55-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(lower,</span>
<span id="cb55-525"><a href="#cb55-525" aria-hidden="true" tabindex="-1"></a>                        upper),</span>
<span id="cb55-526"><a href="#cb55-526" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"y_window"</span>,</span>
<span id="cb55-527"><a href="#cb55-527" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"bound"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-528"><a href="#cb55-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Element,</span>
<span id="cb55-529"><a href="#cb55-529" aria-hidden="true" tabindex="-1"></a>         Location,</span>
<span id="cb55-530"><a href="#cb55-530" aria-hidden="true" tabindex="-1"></a>         date_first, </span>
<span id="cb55-531"><a href="#cb55-531" aria-hidden="true" tabindex="-1"></a>         y_window,</span>
<span id="cb55-532"><a href="#cb55-532" aria-hidden="true" tabindex="-1"></a>         bound))</span>
<span id="cb55-533"><a href="#cb55-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-534"><a href="#cb55-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-535"><a href="#cb55-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-536"><a href="#cb55-536" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualizations</span></span>
<span id="cb55-537"><a href="#cb55-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-538"><a href="#cb55-538" aria-hidden="true" tabindex="-1"></a><span class="fu">### Strategy and descriptions</span></span>
<span id="cb55-539"><a href="#cb55-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-540"><a href="#cb55-540" aria-hidden="true" tabindex="-1"></a>Here are descriptions of each feature of the final visuals and how they will be constructed.</span>
<span id="cb55-541"><a href="#cb55-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-542"><a href="#cb55-542" aria-hidden="true" tabindex="-1"></a>Overall plot features / strategy:</span>
<span id="cb55-543"><a href="#cb55-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-544"><a href="#cb55-544" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Never need to group by location because that gets facetted.</span>
<span id="cb55-545"><a href="#cb55-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-546"><a href="#cb55-546" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Filtering dataset for each geom for the correct element so that the code can remain the same between plots for the different responses.</span>
<span id="cb55-547"><a href="#cb55-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-548"><a href="#cb55-548" aria-hidden="true" tabindex="-1"></a>-- Only have to set a constant for the element and main color at the start and then the ggplot is set up to incorporate that automatically.</span>
<span id="cb55-549"><a href="#cb55-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-550"><a href="#cb55-550" aria-hidden="true" tabindex="-1"></a>-- Using blue because of Storytelling With Data (SWD).</span>
<span id="cb55-551"><a href="#cb55-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-552"><a href="#cb55-552" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Neutral colors will be various greys cause not as strong as black.</span>
<span id="cb55-553"><a href="#cb55-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-554"><a href="#cb55-554" aria-hidden="true" tabindex="-1"></a>Line plot of the average monthly values:</span>
<span id="cb55-555"><a href="#cb55-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-556"><a href="#cb55-556" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Purpose is to show variability over time of avg values.</span>
<span id="cb55-557"><a href="#cb55-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-558"><a href="#cb55-558" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Not the focus, so make thinner and slightly transparent.</span>
<span id="cb55-559"><a href="#cb55-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-560"><a href="#cb55-560" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Adds the grouping variable so that the gap in the missing data shown with two separate lines rather than connecting across the gap.</span>
<span id="cb55-561"><a href="#cb55-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-562"><a href="#cb55-562" aria-hidden="true" tabindex="-1"></a>Smooth curve of daily temps:</span>
<span id="cb55-563"><a href="#cb55-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-564"><a href="#cb55-564" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Plots loess model of daily values over time.</span>
<span id="cb55-565"><a href="#cb55-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-566"><a href="#cb55-566" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This model (including its parameters) is the same that was used to get the last predicted value in the projection data.</span>
<span id="cb55-567"><a href="#cb55-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-568"><a href="#cb55-568" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This is a main part of the plot, so thicker line.</span>
<span id="cb55-569"><a href="#cb55-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-570"><a href="#cb55-570" aria-hidden="true" tabindex="-1"></a>Baseline plot:</span>
<span id="cb55-571"><a href="#cb55-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-572"><a href="#cb55-572" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Uses projection data.</span>
<span id="cb55-573"><a href="#cb55-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-574"><a href="#cb55-574" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Just a horizontal line at the first 5 year avg of daily values.</span>
<span id="cb55-575"><a href="#cb55-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-576"><a href="#cb55-576" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This is for comparison purposes, not a main focus so choosing a neutral color with a thinner line than the smooth curve (but thicker than the monthly avgs).</span>
<span id="cb55-577"><a href="#cb55-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-578"><a href="#cb55-578" aria-hidden="true" tabindex="-1"></a>Error bar:</span>
<span id="cb55-579"><a href="#cb55-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-580"><a href="#cb55-580" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Uses projection data.</span>
<span id="cb55-581"><a href="#cb55-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-582"><a href="#cb55-582" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sets $x$ last day of data collection, $y$ values are the last predicted value and baseline avg.</span>
<span id="cb55-583"><a href="#cb55-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-584"><a href="#cb55-584" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This is a standout feature of the plot, color will set manually based on what should be the focus.</span>
<span id="cb55-585"><a href="#cb55-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-586"><a href="#cb55-586" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Want to highlight the increases in temp (based on model compared to historical average) for narrative of the entire data viz.</span>
<span id="cb55-587"><a href="#cb55-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-588"><a href="#cb55-588" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>And just changes in precipitation, not focusing on whether the change is an increase or decrease.</span>
<span id="cb55-589"><a href="#cb55-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-590"><a href="#cb55-590" aria-hidden="true" tabindex="-1"></a>Text labels for error bars:</span>
<span id="cb55-591"><a href="#cb55-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-592"><a href="#cb55-592" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Uses projection data.</span>
<span id="cb55-593"><a href="#cb55-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-594"><a href="#cb55-594" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Set to the right of the error bars and centered at the midpoint.</span>
<span id="cb55-595"><a href="#cb55-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-596"><a href="#cb55-596" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Color coordinated with the error bars.</span>
<span id="cb55-597"><a href="#cb55-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-598"><a href="#cb55-598" aria-hidden="true" tabindex="-1"></a>Color scale for error bars and labels:</span>
<span id="cb55-599"><a href="#cb55-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-600"><a href="#cb55-600" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For temps set a bright color for the errors that I want to highlight and a neutral color for the rest.</span>
<span id="cb55-601"><a href="#cb55-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-602"><a href="#cb55-602" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Using orange cause of SWD (blue / orange are good contrasting colors that don't have an immediate connotation like red / green).</span>
<span id="cb55-603"><a href="#cb55-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-604"><a href="#cb55-604" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For precipitation, not highlighting whether a change was $+/-$, so use two bright colors (rather than one bright and one neutral).</span>
<span id="cb55-605"><a href="#cb55-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-606"><a href="#cb55-606" aria-hidden="true" tabindex="-1"></a>Window (range) setting:</span>
<span id="cb55-607"><a href="#cb55-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-608"><a href="#cb55-608" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This plot feature will be set up as an option within the function via a conditional statement.</span>
<span id="cb55-609"><a href="#cb55-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-610"><a href="#cb55-610" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Set up as an option so that it there is a concise way to add it in while also easily being able to have or not have it.</span>
<span id="cb55-611"><a href="#cb55-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-612"><a href="#cb55-612" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Had to manually look into what to set the window bounds as, so this feature is just for the final visualizations.</span>
<span id="cb55-613"><a href="#cb55-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-614"><a href="#cb55-614" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Uses plot values limits dataset.</span>
<span id="cb55-615"><a href="#cb55-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-616"><a href="#cb55-616" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Just adds data points set at the desired lower and upper bounds for each locations $y$ scale.</span>
<span id="cb55-617"><a href="#cb55-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-618"><a href="#cb55-618" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These data points are just to force the scales to include the correct range, so can make points invisible.</span>
<span id="cb55-619"><a href="#cb55-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-620"><a href="#cb55-620" aria-hidden="true" tabindex="-1"></a>Final aspects:</span>
<span id="cb55-621"><a href="#cb55-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-622"><a href="#cb55-622" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Facet by location.</span>
<span id="cb55-623"><a href="#cb55-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-624"><a href="#cb55-624" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Modify theme slightly.</span>
<span id="cb55-625"><a href="#cb55-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-626"><a href="#cb55-626" aria-hidden="true" tabindex="-1"></a><span class="fu">### Function for implementation</span></span>
<span id="cb55-627"><a href="#cb55-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-628"><a href="#cb55-628" aria-hidden="true" tabindex="-1"></a>To implement these, lets define a function that will create a ggplot object with all of the above features that will be common across all plots. This is just for more concise code later; element specific features (such as labels and scale colors) will be added on individually later. And formal titles and captions will be added on last.</span>
<span id="cb55-629"><a href="#cb55-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-632"><a href="#cb55-632" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-633"><a href="#cb55-633" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: function-common-plot</span></span>
<span id="cb55-634"><a href="#cb55-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-635"><a href="#cb55-635" aria-hidden="true" tabindex="-1"></a><span class="co"># define a function that will return a ggplot object with all of the above features</span></span>
<span id="cb55-636"><a href="#cb55-636" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; only need to specify character strings for the element of interest and the main color of the line plots</span></span>
<span id="cb55-637"><a href="#cb55-637" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; default color value is black (which is neutralish) just so that can run code if don't want to specify one</span></span>
<span id="cb55-638"><a href="#cb55-638" aria-hidden="true" tabindex="-1"></a><span class="co"># this will contain only plot feature that are common across all elements</span></span>
<span id="cb55-639"><a href="#cb55-639" aria-hidden="true" tabindex="-1"></a><span class="co"># element specific features (such as labels and scale colors) will be tacked on afterwards, as well as the formal titles / captions</span></span>
<span id="cb55-640"><a href="#cb55-640" aria-hidden="true" tabindex="-1"></a><span class="co"># so when plotting a specific element, just have to call this function and then the rest of the layers that are modified to have info specific to the element of interest</span></span>
<span id="cb55-641"><a href="#cb55-641" aria-hidden="true" tabindex="-1"></a><span class="co"># note that this function depends on objects in the global environment</span></span>
<span id="cb55-642"><a href="#cb55-642" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; so not necessarily the best way to code it</span></span>
<span id="cb55-643"><a href="#cb55-643" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; but the datasets it requires have to be setup in a specific way according to the above data manipulations</span></span>
<span id="cb55-644"><a href="#cb55-644" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; so this is just much easier and makes sense for how this application was carried out </span></span>
<span id="cb55-645"><a href="#cb55-645" aria-hidden="true" tabindex="-1"></a>fun_common_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(element,</span>
<span id="cb55-646"><a href="#cb55-646" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb55-647"><a href="#cb55-647" aria-hidden="true" tabindex="-1"></a>                            <span class="at">window_setting =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb55-648"><a href="#cb55-648" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-649"><a href="#cb55-649" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create and save base plot object</span></span>
<span id="cb55-650"><a href="#cb55-650" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">=</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb55-651"><a href="#cb55-651" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> date,</span>
<span id="cb55-652"><a href="#cb55-652" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> value_avg,</span>
<span id="cb55-653"><a href="#cb55-653" aria-hidden="true" tabindex="-1"></a>                  <span class="at">group =</span> line_plot_group),</span>
<span id="cb55-654"><a href="#cb55-654" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> color,</span>
<span id="cb55-655"><a href="#cb55-655" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="fl">0.25</span>,</span>
<span id="cb55-656"><a href="#cb55-656" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.25</span>,</span>
<span id="cb55-657"><a href="#cb55-657" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> <span class="fu">filter</span>(data_monlthy_avg,</span>
<span id="cb55-658"><a href="#cb55-658" aria-hidden="true" tabindex="-1"></a>                            Element <span class="sc">==</span> element)) <span class="sc">+</span> </span>
<span id="cb55-659"><a href="#cb55-659" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb55-660"><a href="#cb55-660" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> value),</span>
<span id="cb55-661"><a href="#cb55-661" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">"loess"</span>,</span>
<span id="cb55-662"><a href="#cb55-662" aria-hidden="true" tabindex="-1"></a>                <span class="at">span =</span> <span class="dv">2</span>,</span>
<span id="cb55-663"><a href="#cb55-663" aria-hidden="true" tabindex="-1"></a>                <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-664"><a href="#cb55-664" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> color,</span>
<span id="cb55-665"><a href="#cb55-665" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">filter</span>(data_climate,</span>
<span id="cb55-666"><a href="#cb55-666" aria-hidden="true" tabindex="-1"></a>                              Element <span class="sc">==</span> element)) <span class="sc">+</span> </span>
<span id="cb55-667"><a href="#cb55-667" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> date_first,</span>
<span id="cb55-668"><a href="#cb55-668" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xend =</span> date_last,</span>
<span id="cb55-669"><a href="#cb55-669" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> value_5avg,</span>
<span id="cb55-670"><a href="#cb55-670" aria-hidden="true" tabindex="-1"></a>                     <span class="at">yend =</span> value_5avg),</span>
<span id="cb55-671"><a href="#cb55-671" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"grey50"</span>,</span>
<span id="cb55-672"><a href="#cb55-672" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> <span class="fu">filter</span>(data_projections,</span>
<span id="cb55-673"><a href="#cb55-673" aria-hidden="true" tabindex="-1"></a>                               Element <span class="sc">==</span> element)) <span class="sc">+</span> </span>
<span id="cb55-674"><a href="#cb55-674" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">x =</span> date_last,</span>
<span id="cb55-675"><a href="#cb55-675" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> value_5avg,</span>
<span id="cb55-676"><a href="#cb55-676" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> last_pred,</span>
<span id="cb55-677"><a href="#cb55-677" aria-hidden="true" tabindex="-1"></a>                      <span class="at">color =</span> error_sign),</span>
<span id="cb55-678"><a href="#cb55-678" aria-hidden="true" tabindex="-1"></a>                  <span class="at">width =</span> <span class="dv">500</span>,</span>
<span id="cb55-679"><a href="#cb55-679" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linewidth =</span> <span class="dv">1</span>, </span>
<span id="cb55-680"><a href="#cb55-680" aria-hidden="true" tabindex="-1"></a>                  <span class="at">show.legend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-681"><a href="#cb55-681" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> <span class="fu">filter</span>(data_projections, </span>
<span id="cb55-682"><a href="#cb55-682" aria-hidden="true" tabindex="-1"></a>                                Element <span class="sc">==</span> element)) <span class="sc">+</span> </span>
<span id="cb55-683"><a href="#cb55-683" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> date_last,</span>
<span id="cb55-684"><a href="#cb55-684" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> error_midpoint,</span>
<span id="cb55-685"><a href="#cb55-685" aria-hidden="true" tabindex="-1"></a>                  <span class="at">label =</span> error_label,</span>
<span id="cb55-686"><a href="#cb55-686" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> error_sign),</span>
<span id="cb55-687"><a href="#cb55-687" aria-hidden="true" tabindex="-1"></a>              <span class="at">nudge_x =</span> <span class="dv">1500</span>,</span>
<span id="cb55-688"><a href="#cb55-688" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb55-689"><a href="#cb55-689" aria-hidden="true" tabindex="-1"></a>              <span class="at">show.legend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-690"><a href="#cb55-690" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> <span class="fu">filter</span>(data_projections,</span>
<span id="cb55-691"><a href="#cb55-691" aria-hidden="true" tabindex="-1"></a>                            Element <span class="sc">==</span> element)) <span class="sc">+</span> </span>
<span id="cb55-692"><a href="#cb55-692" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(Location <span class="sc">~</span> .,</span>
<span id="cb55-693"><a href="#cb55-693" aria-hidden="true" tabindex="-1"></a>               <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span> </span>
<span id="cb55-694"><a href="#cb55-694" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-695"><a href="#cb55-695" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb55-696"><a href="#cb55-696" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb55-697"><a href="#cb55-697" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-698"><a href="#cb55-698" aria-hidden="true" tabindex="-1"></a>  <span class="co"># conditionally add range setting feature</span></span>
<span id="cb55-699"><a href="#cb55-699" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (window_setting) {</span>
<span id="cb55-700"><a href="#cb55-700" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">=</span> g <span class="sc">+</span> </span>
<span id="cb55-701"><a href="#cb55-701" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> date_first,</span>
<span id="cb55-702"><a href="#cb55-702" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> bound),</span>
<span id="cb55-703"><a href="#cb55-703" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha =</span> <span class="dv">0</span>,</span>
<span id="cb55-704"><a href="#cb55-704" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> <span class="fu">filter</span>(data_y_limits,</span>
<span id="cb55-705"><a href="#cb55-705" aria-hidden="true" tabindex="-1"></a>                               Element <span class="sc">==</span> element))</span>
<span id="cb55-706"><a href="#cb55-706" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-707"><a href="#cb55-707" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-708"><a href="#cb55-708" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return plot object</span></span>
<span id="cb55-709"><a href="#cb55-709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(g)</span>
<span id="cb55-710"><a href="#cb55-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-711"><a href="#cb55-711" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-712"><a href="#cb55-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-713"><a href="#cb55-713" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-714"><a href="#cb55-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-715"><a href="#cb55-715" aria-hidden="true" tabindex="-1"></a><span class="fu">### Minumum temperatures</span></span>
<span id="cb55-716"><a href="#cb55-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-717"><a href="#cb55-717" aria-hidden="true" tabindex="-1"></a>Create base plot for minimum temperatures. This lets the facetting control the $y$ scales and does not activate the window setting feature.</span>
<span id="cb55-718"><a href="#cb55-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-721"><a href="#cb55-721" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-722"><a href="#cb55-722" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-tmin-common</span></span>
<span id="cb55-723"><a href="#cb55-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-724"><a href="#cb55-724" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize TMIN</span></span>
<span id="cb55-725"><a href="#cb55-725" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; first visualize base plot </span></span>
<span id="cb55-726"><a href="#cb55-726" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_common_plot</span>(<span class="at">element =</span> <span class="st">"TMIN"</span>,</span>
<span id="cb55-727"><a href="#cb55-727" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"dodgerblue1"</span>,</span>
<span id="cb55-728"><a href="#cb55-728" aria-hidden="true" tabindex="-1"></a>                <span class="at">window_setting =</span> <span class="cn">FALSE</span>)</span>
<span id="cb55-729"><a href="#cb55-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-730"><a href="#cb55-730" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-731"><a href="#cb55-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-732"><a href="#cb55-732" aria-hidden="true" tabindex="-1"></a>Now incorporate the specified windows into each panel.</span>
<span id="cb55-733"><a href="#cb55-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-736"><a href="#cb55-736" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-737"><a href="#cb55-737" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-tmin-window</span></span>
<span id="cb55-738"><a href="#cb55-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-739"><a href="#cb55-739" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; now add window setting feature</span></span>
<span id="cb55-740"><a href="#cb55-740" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_common_plot</span>(<span class="at">element =</span> <span class="st">"TMIN"</span>,</span>
<span id="cb55-741"><a href="#cb55-741" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"dodgerblue1"</span>,</span>
<span id="cb55-742"><a href="#cb55-742" aria-hidden="true" tabindex="-1"></a>                <span class="at">window_setting =</span> <span class="cn">TRUE</span>)</span>
<span id="cb55-743"><a href="#cb55-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-744"><a href="#cb55-744" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-745"><a href="#cb55-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-746"><a href="#cb55-746" aria-hidden="true" tabindex="-1"></a>We see that this addition has the intended affect of setting equally wide and centered windows for each panels $y$ axis, which improves the image and allows for accurate visual comparisons of the error bars. So lets keep it! Now we can create the final visualization for minimum temperatures.</span>
<span id="cb55-747"><a href="#cb55-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-750"><a href="#cb55-750" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-751"><a href="#cb55-751" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-tmin-final</span></span>
<span id="cb55-752"><a href="#cb55-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-753"><a href="#cb55-753" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; then add the rest of the layers with formal info</span></span>
<span id="cb55-754"><a href="#cb55-754" aria-hidden="true" tabindex="-1"></a>(plot_tmin <span class="ot">&lt;-</span> <span class="fu">fun_common_plot</span>(<span class="at">element =</span> <span class="st">"TMIN"</span>,</span>
<span id="cb55-755"><a href="#cb55-755" aria-hidden="true" tabindex="-1"></a>                             <span class="at">color =</span> <span class="st">"dodgerblue1"</span>,</span>
<span id="cb55-756"><a href="#cb55-756" aria-hidden="true" tabindex="-1"></a>                             <span class="at">window_setting =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb55-757"><a href="#cb55-757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"-"</span> <span class="ot">=</span> <span class="st">"grey60"</span>, <span class="st">"+"</span> <span class="ot">=</span> <span class="st">"orange"</span>)) <span class="sc">+</span> </span>
<span id="cb55-758"><a href="#cb55-758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Average minimum temperatures over time </span><span class="sc">\n</span><span class="st">compared to average during first five years"</span>,</span>
<span id="cb55-759"><a href="#cb55-759" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"(with monthly averages overlaid)"</span>,</span>
<span id="cb55-760"><a href="#cb55-760" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Data source: Daily Global Historical Climatology Network (GHCN) </span><span class="sc">\n</span><span class="st">Plot by Colton Gearhart"</span>,</span>
<span id="cb55-761"><a href="#cb55-761" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Temperature (˚C)"</span>)) </span>
<span id="cb55-762"><a href="#cb55-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-763"><a href="#cb55-763" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-764"><a href="#cb55-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-765"><a href="#cb55-765" aria-hidden="true" tabindex="-1"></a><span class="fu">### Maximum temperatures</span></span>
<span id="cb55-766"><a href="#cb55-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-767"><a href="#cb55-767" aria-hidden="true" tabindex="-1"></a>Now we can do the same process for maximumum temperatures.</span>
<span id="cb55-768"><a href="#cb55-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-771"><a href="#cb55-771" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-772"><a href="#cb55-772" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-tmax-common</span></span>
<span id="cb55-773"><a href="#cb55-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-774"><a href="#cb55-774" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize TMAX</span></span>
<span id="cb55-775"><a href="#cb55-775" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; first create base plot </span></span>
<span id="cb55-776"><a href="#cb55-776" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_common_plot</span>(<span class="at">element =</span> <span class="st">"TMAX"</span>,</span>
<span id="cb55-777"><a href="#cb55-777" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"dodgerblue4"</span>, </span>
<span id="cb55-778"><a href="#cb55-778" aria-hidden="true" tabindex="-1"></a>                <span class="at">window_setting =</span> <span class="cn">FALSE</span>)</span>
<span id="cb55-779"><a href="#cb55-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-780"><a href="#cb55-780" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-781"><a href="#cb55-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-784"><a href="#cb55-784" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-785"><a href="#cb55-785" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-tmax-window</span></span>
<span id="cb55-786"><a href="#cb55-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-787"><a href="#cb55-787" aria-hidden="true" tabindex="-1"></a><span class="co"># this improves image again, so keep it!</span></span>
<span id="cb55-788"><a href="#cb55-788" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; now add window setting feature</span></span>
<span id="cb55-789"><a href="#cb55-789" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_common_plot</span>(<span class="at">element =</span> <span class="st">"TMAX"</span>,</span>
<span id="cb55-790"><a href="#cb55-790" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"dodgerblue4"</span>,</span>
<span id="cb55-791"><a href="#cb55-791" aria-hidden="true" tabindex="-1"></a>                <span class="at">window_setting =</span> <span class="cn">TRUE</span>)</span>
<span id="cb55-792"><a href="#cb55-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-793"><a href="#cb55-793" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-794"><a href="#cb55-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-797"><a href="#cb55-797" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-798"><a href="#cb55-798" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-tmax-final</span></span>
<span id="cb55-799"><a href="#cb55-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-800"><a href="#cb55-800" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; then add the rest of the layers with formal info</span></span>
<span id="cb55-801"><a href="#cb55-801" aria-hidden="true" tabindex="-1"></a><span class="co"># this is the final visualization for maximum temperatures</span></span>
<span id="cb55-802"><a href="#cb55-802" aria-hidden="true" tabindex="-1"></a>(plot_tmax <span class="ot">&lt;-</span> <span class="fu">fun_common_plot</span>(<span class="at">element =</span> <span class="st">"TMAX"</span>,</span>
<span id="cb55-803"><a href="#cb55-803" aria-hidden="true" tabindex="-1"></a>                              <span class="at">color =</span> <span class="st">"dodgerblue4"</span>,</span>
<span id="cb55-804"><a href="#cb55-804" aria-hidden="true" tabindex="-1"></a>                              <span class="at">window_setting =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> </span>
<span id="cb55-805"><a href="#cb55-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"-"</span> <span class="ot">=</span> <span class="st">"grey60"</span>, <span class="st">"+"</span> <span class="ot">=</span> <span class="st">"orange"</span>)) <span class="sc">+</span> </span>
<span id="cb55-806"><a href="#cb55-806" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Average maximum temperatures over time </span><span class="sc">\n</span><span class="st">compared to average during first five years"</span>,</span>
<span id="cb55-807"><a href="#cb55-807" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"(with monthly averages overlaid)"</span>,</span>
<span id="cb55-808"><a href="#cb55-808" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Data source: Daily Global Historical Climatology Network (GHCN) </span><span class="sc">\n</span><span class="st">Plot by Colton Gearhart"</span>,</span>
<span id="cb55-809"><a href="#cb55-809" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Temperature (˚C)"</span>)) </span>
<span id="cb55-810"><a href="#cb55-810" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb55-811"><a href="#cb55-811" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-812"><a href="#cb55-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-813"><a href="#cb55-813" aria-hidden="true" tabindex="-1"></a><span class="fu">### Precipitation levels</span></span>
<span id="cb55-814"><a href="#cb55-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-815"><a href="#cb55-815" aria-hidden="true" tabindex="-1"></a>And again for precipitation levels.</span>
<span id="cb55-816"><a href="#cb55-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-819"><a href="#cb55-819" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-820"><a href="#cb55-820" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-prcp-common</span></span>
<span id="cb55-821"><a href="#cb55-821" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize PRCP</span></span>
<span id="cb55-822"><a href="#cb55-822" aria-hidden="true" tabindex="-1"></a><span class="co">#  -&gt; first create base plot </span></span>
<span id="cb55-823"><a href="#cb55-823" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_common_plot</span>(<span class="at">element =</span> <span class="st">"PRCP"</span>,</span>
<span id="cb55-824"><a href="#cb55-824" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"turquoise"</span>,</span>
<span id="cb55-825"><a href="#cb55-825" aria-hidden="true" tabindex="-1"></a>                <span class="at">window_setting =</span> <span class="cn">FALSE</span>)</span>
<span id="cb55-826"><a href="#cb55-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-827"><a href="#cb55-827" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-828"><a href="#cb55-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-831"><a href="#cb55-831" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-832"><a href="#cb55-832" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-prcp-window</span></span>
<span id="cb55-833"><a href="#cb55-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-834"><a href="#cb55-834" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; now add window setting feature</span></span>
<span id="cb55-835"><a href="#cb55-835" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_common_plot</span>(<span class="at">element =</span> <span class="st">"PRCP"</span>,</span>
<span id="cb55-836"><a href="#cb55-836" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"turquoise"</span>,</span>
<span id="cb55-837"><a href="#cb55-837" aria-hidden="true" tabindex="-1"></a>                <span class="at">window_setting =</span> <span class="cn">TRUE</span>)</span>
<span id="cb55-838"><a href="#cb55-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-839"><a href="#cb55-839" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-840"><a href="#cb55-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-843"><a href="#cb55-843" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-844"><a href="#cb55-844" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-prcp-final</span></span>
<span id="cb55-845"><a href="#cb55-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-846"><a href="#cb55-846" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; then add the rest of the layers with formal info</span></span>
<span id="cb55-847"><a href="#cb55-847" aria-hidden="true" tabindex="-1"></a>(plot_prcp <span class="ot">&lt;-</span> <span class="fu">fun_common_plot</span>(<span class="at">element =</span> <span class="st">"PRCP"</span>,</span>
<span id="cb55-848"><a href="#cb55-848" aria-hidden="true" tabindex="-1"></a>                             <span class="at">color =</span> <span class="st">"turquoise"</span>,</span>
<span id="cb55-849"><a href="#cb55-849" aria-hidden="true" tabindex="-1"></a>                             <span class="at">window_setting =</span> <span class="cn">TRUE</span>) <span class="sc">+</span>  </span>
<span id="cb55-850"><a href="#cb55-850" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"-"</span> <span class="ot">=</span> <span class="st">"gold2"</span>, <span class="st">"+"</span> <span class="ot">=</span> <span class="st">"plum2"</span>)) <span class="sc">+</span> </span>
<span id="cb55-851"><a href="#cb55-851" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Average precipitation levels over time </span><span class="sc">\n</span><span class="st">compared to average during first five years"</span>,</span>
<span id="cb55-852"><a href="#cb55-852" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"(with monthly averages overlaid)"</span>,</span>
<span id="cb55-853"><a href="#cb55-853" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Data source: Daily Global Historical Climatology Network (GHCN) </span><span class="sc">\n</span><span class="st">Plot by Colton Gearhart"</span>,</span>
<span id="cb55-854"><a href="#cb55-854" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Precipitation (mm)"</span>))</span>
<span id="cb55-855"><a href="#cb55-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-856"><a href="#cb55-856" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-857"><a href="#cb55-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-858"><a href="#cb55-858" aria-hidden="true" tabindex="-1"></a>Note that there is a natural lower bound of zero for precipitation levels and there is high variability in HI. So by forcing each panel to have the same range via the window setting, effects (i.e. error bars) are barely visible, but there is nothing that can really be done about this given the current implementation strategy. But perhaps the lack of effect (or minimal effect) tells something as well? This would likely be a question for a content expert.</span>
<span id="cb55-859"><a href="#cb55-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-860"><a href="#cb55-860" aria-hidden="true" tabindex="-1"></a><span class="fu">## Save plots</span></span>
<span id="cb55-861"><a href="#cb55-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-862"><a href="#cb55-862" aria-hidden="true" tabindex="-1"></a>Below is code that can be used to save ggplots.</span>
<span id="cb55-863"><a href="#cb55-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-866"><a href="#cb55-866" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-867"><a href="#cb55-867" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: save-plots</span></span>
<span id="cb55-868"><a href="#cb55-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-869"><a href="#cb55-869" aria-hidden="true" tabindex="-1"></a><span class="co"># save plots</span></span>
<span id="cb55-870"><a href="#cb55-870" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">"Files/Images/Visual-TMIN.png"</span>,</span>
<span id="cb55-871"><a href="#cb55-871" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> plot_tmin)</span>
<span id="cb55-872"><a href="#cb55-872" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">"Files/Images/Visual-TMAX.png"</span>,</span>
<span id="cb55-873"><a href="#cb55-873" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> plot_tmax)</span>
<span id="cb55-874"><a href="#cb55-874" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">"Files/Images/Visual-PRCP.png"</span>,</span>
<span id="cb55-875"><a href="#cb55-875" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> plot_prcp)</span>
<span id="cb55-876"><a href="#cb55-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-877"><a href="#cb55-877" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>